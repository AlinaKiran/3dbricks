var COMPILED=!0,goog=goog||{};goog.global=this;goog.DEBUG=!0;goog.LOCALE="en";goog.evalWorksForGlobals_=null;goog.provide=function(a){if(!COMPILED){if(goog.getObjectByName(a)&&!goog.implicitNamespaces_[a])throw Error('Namespace "'+a+'" already declared.');for(var b=a;b=b.substring(0,b.lastIndexOf("."));)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)};COMPILED||(goog.implicitNamespaces_={});
goog.exportPath_=function(a,b,d){a=a.split(".");d=d||goog.global;!(a[0]in d)&&d.execScript&&d.execScript("var "+a[0]);for(var f;a.length&&(f=a.shift());)!a.length&&goog.isDef(b)?d[f]=b:d=d[f]?d[f]:d[f]={}};goog.getObjectByName=function(a,b){for(var d=a.split("."),f=b||goog.global,g;g=d.shift();)if(f[g])f=f[g];else return null;return f};goog.globalize=function(a,b){var d=b||goog.global,f;for(f in a)d[f]=a[f]};
goog.addDependency=function(a,b,d){if(!COMPILED){for(var f,a=a.replace(/\\/g,"/"),g=goog.dependencies_,h=0;f=b[h];h++)g.nameToPath[f]=a,a in g.pathToNames||(g.pathToNames[a]={}),g.pathToNames[a][f]=!0;for(f=0;b=d[f];f++)a in g.requires||(g.requires[a]={}),g.requires[a][b]=!0}};
goog.require=function(a){if(!COMPILED&&!goog.getObjectByName(a)){var b=goog.getPathFromDeps_(a);if(b)goog.included_[b]=!0,goog.writeScripts_();else throw a="goog.require could not find: "+a,goog.global.console&&goog.global.console.error(a),Error(a);}};goog.basePath="";goog.nullFunction=function(){};goog.identityFunction=function(a){return a};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};
goog.addSingletonGetter=function(a){a.getInstance=function(){return a.instance_||(a.instance_=new a)}};
COMPILED||(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.inHtmlDocument_()){var a=goog.global.document;if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else for(var a=a.getElementsByTagName("script"),b=a.length-1;0<=b;--b){var d=a[b].src,f=d.length;if("base.js"==d.substr(f-7)){goog.basePath=
d.substr(0,f-7);break}}}},goog.writeScriptTag_=function(a){goog.inHtmlDocument_()&&!goog.dependencies_.written[a]&&(goog.dependencies_.written[a]=!0,goog.global.document.write('<script type="text/javascript" src="'+a+'"><\/script>'))},goog.writeScripts_=function(){function a(h){if(!(h in f.written)){if(!(h in f.visited)&&(f.visited[h]=!0,h in f.requires))for(var c in f.requires[h])if(c in f.nameToPath)a(f.nameToPath[c]);else if(!goog.getObjectByName(c))throw Error("Undefined nameToPath for "+c);h in
d||(d[h]=!0,b.push(h))}}var b=[],d={},f=goog.dependencies_,g;for(g in goog.included_)f.written[g]||a(g);for(g=0;g<b.length;g++)if(b[g])goog.writeScriptTag_(goog.basePath+b[g]);else throw Error("Undefined script input");},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.writeScriptTag_(goog.basePath+"deps.js"));
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array||!(a instanceof Object)&&"[object Array]"==Object.prototype.toString.call(a)||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if(!(a instanceof Object)&&("[object Function]"==Object.prototype.toString.call(a)||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call")))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.propertyIsEnumerableCustom_=function(a,b){if(b in a)for(var d in a)if(d==b&&Object.prototype.hasOwnProperty.call(a,b))return!0;return!1};goog.propertyIsEnumerable_=function(a,b){return a instanceof Object?Object.prototype.propertyIsEnumerable.call(a,b):goog.propertyIsEnumerableCustom_(a,b)};goog.isDef=function(a){return void 0!==a};goog.isNull=function(a){return null===a};
goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};
goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){a=goog.typeOf(a);return"object"==a||"array"==a||"function"==a};goog.getUid=function(a){if(a.hasOwnProperty&&a.hasOwnProperty(goog.UID_PROPERTY_))return a[goog.UID_PROPERTY_];a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_);return a[goog.UID_PROPERTY_]};goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};
goog.UID_PROPERTY_="closure_uid_"+Math.floor(2147483648*Math.random()).toString(36);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},d;for(d in a)b[d]=goog.cloneObject(a[d]);return b}return a};
goog.bind=function(a,b,d){var f=b||goog.global;if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(b,g);return a.apply(f,b)}}return function(){return a.apply(f,arguments)}};goog.partial=function(a,b){var d=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,d);return a.apply(this,b)}};
goog.mixin=function(a,b){for(var d in b)a[d]=b[d]};goog.now=Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,d=b.createElement("script");d.type="text/javascript";d.defer=!1;d.appendChild(b.createTextNode(a));b.body.appendChild(d);
b.body.removeChild(d)}else throw Error("goog.globalEval not available");};goog.typedef=!0;goog.getCssName=function(a,b){var d=a+(b?"-"+b:"");return goog.cssNameMapping_&&d in goog.cssNameMapping_?goog.cssNameMapping_[d]:d};goog.setCssNameMapping=function(a){goog.cssNameMapping_=a};goog.getMsg=function(a,b){var d=b||{},f;for(f in d)a=a.replace(RegExp("\\{\\$"+f+"\\}","gi"),d[f]);return a};goog.exportSymbol=function(a,b,d){goog.exportPath_(a,b,d)};goog.exportProperty=function(a,b,d){a[b]=d};
goog.inherits=function(a,b){function d(){}d.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new d;a.prototype.constructor=a};
goog.base=function(a,b,d){var f=arguments.callee.caller;if(f.superClass_)return f.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var g=Array.prototype.slice.call(arguments,2),h=!1,c=a.constructor;c;c=c.superClass_&&c.superClass_.constructor)if(c.prototype[b]===f)h=!0;else if(h)return c.prototype[b].apply(a,g);if(a[b]===f)return a.constructor.prototype[b].apply(a,g);throw Error("goog.base called from a method of one name to a method of a different name");};var bricks3d={hud:{}};
function Hud(){var a,b,d=function(){b.fillRect(0,0,1E3,600);b.clearRect(0,0,1E3,600)};this.drawGameStatistics=function(a,f,c){d();b.fillStyle="#ffffff";b.fillRect(0,560,1E3,40,0.5);b.fillStyle="#333333";b.font="normal 24pt sans-serif";b.fillText("score "+a,20,588);b.fillText("level "+f,880,588);a=20;for(f=0;f<c;f++)b.beginPath(),b.arc(a,20,12,0,2*Math.PI,!1),b.fillStyle="#777777",b.fill(),b.lineWidth=3,b.strokeStyle="#222222",b.stroke(),a+=28};var f=!1;this.showCredits=function(){function a(){f||(b-=
1,document.getElementById("creditsText").style.marginTop=b+"px",setTimeout(function(){a()},20))}f=!1;var b=634;document.getElementById("creditsText").style.display="block";a()};this.stopCredits=function(){f=!0;document.getElementById("creditsText").style.display="none"};this.clear=function(){d()};a=document.createElement("canvas");a.height=600;a.width=1E3;document.getElementById("2dcanvas").appendChild(a);b=a.getContext("2d");b.canvas.width=1E3;b.globalAlpha=0.5;b.canvas.height=600};bricks3d.brickgame={};
function BrickGame(){function a(a,b,e){var d=new Ball(c,c.box2dworld);d.create(a,b,e);m.push(d);k.push(d);ev.pub("game.ball.created",d);return d}function b(){for(var a=c.children.length-1;0<=a;a--)c.remove(c.children[a]);for(;a=c.box2dworld.GetBodyList().GetNext();)c.box2dworld.DestroyBody(a);k=[]}function d(a){G=a.GetFixtureA();H=a.GetFixtureB();r=G.GetBody();q=H.GetBody();if(r.userData&&"ball"==r.userData.name&&q.userData&&"brick"==q.userData.name)w=r,brick=q;else if(q.userData&&"ball"==q.userData.name&&
r.userData&&"brick"==r.userData.name)w=q,brick=r;else if(r.userData&&"paddle"==r.userData.name||q.userData&&"paddle"==q.userData.name){a=null;r.userData&&"ball"==r.userData.name?a=r:q.userData&&"ball"==q.userData.name&&(a=q);if(a){var c=a.GetLinearVelocity(),b=Math.abs(c.x),e=1;1>Math.abs(c.y)/b&&(e=b,0<=c.y?a.SetLinearVelocity(new b2Vec2(c.x,e)):0>=c.y&&a.SetLinearVelocity(new b2Vec2(c.x,-e)));Math.abs(e)}ev.pub("game.paddleHit",n)}w&&brick&&brick.userData.hitCount?(brick.userData.hitCount-=1,I--,
ev.pub("game.brickHit",{bricksLeft:I,brick:brick,ball:w})):ev.pub("game.wallCollition")}function f(){K=!0;v=0;for(len=A.length;v<len;v++)A[v].dirty=!0,A[v]();for(v=A.length-1;0<=v;v--)A[v].dirty&&A.splice(v,1);if(C.length){for(var a=0;a<C.length;a++)c.box2dworld.DestroyBody(C[a]),c.remove(C[a].userData.guiref);C=[]}for(F=0;F<k.length;F++)k[F].sync(),k[F].validate();l||(n.updateControls(),s=n.body.GetPosition().x,J=n.body.GetPosition().y,t=new Date,c.box2dworld.Step(1/60,10,10),c.box2dworld.ClearForces(),
t2=new Date-t);u&&h.lookAt({x:u.position.x,y:u.position.y+2,z:u.position.z});moveCameraSchedule();h.rotation.z=0;y&&(h.position.x=n.mesh.position.x/1.3);c.box2dworld.SetGravity(new b2Vec2((0-n.mesh.position.x)/6,-0.7));i.clear(!1,!0,!1);j.render(0.01);for(var a=0,b=B.length;a<b;a++)B[a].dirty=!0,B[a]();for(a=B.length-1;0<=a;a--)B[a].dirty&&B.splice(a,1);requestAnimationFrame(f)}var g,h,c,i,j,k=[],l=!1,n,m=[],x=[],s=0,J=-4,I=0,p=this,u;b2Vec2=Box2D.Common.Math.b2Vec2;b2AABB=Box2D.Collision.b2AABB;
b2BodyDef=Box2D.Dynamics.b2BodyDef;b2Body=Box2D.Dynamics.b2Body;b2FixtureDef=Box2D.Dynamics.b2FixtureDef;b2Fixture=Box2D.Dynamics.b2Fixture;b2World=Box2D.Dynamics.b2World;b2PolygonDef=Box2D.Dynamics.b2PolygonDef;b2MassData=Box2D.Collision.Shapes.b2MassData;b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape;b2CircleShape=Box2D.Collision.Shapes.b2CircleShape;b2DebugDraw=Box2D.Dynamics.b2DebugDraw;b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef;b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef;
var y=!1;this.init=function(){h=new THREE.PerspectiveCamera(50,1E3/600,1,1E3);h.position.z=1;h.position.x=0;h.position.y=-10;h.up={x:0,y:0,z:1};h.eulerOrder="XZY";h.lookAt({x:0,y:4,z:-4});c=new THREE.Scene;var a=new b2World(new b2Vec2(0,-1),!0);c.box2dworld=a;var b=new Box2D.Dynamics.b2ContactListener;b.BeginContact=d;b.PreSolve=L;a.SetContactListener(b);i=new THREE.WebGLRenderer;i.autoClear=!1;i.sortObjects=!0;i.shadowMapEnabled=!0;i.physicallyBasedShading=!0;i.shadowMapDarkness=0.5;i.shadowMapWidth=
1024;i.shadowMapHeight=1024;i.setClearColor(16777215,0);i.setSize(1E3,600);document.getElementById("3dcanvas").appendChild(i.domElement);a=new THREE.RenderPass(c,h);a.clearColor=1118481;a.clearAlpha=0;(new THREE.FilmPass(0.01,0.1,448,!1)).renderToScreen=!0;effectFocus=new THREE.ShaderPass(THREE.FocusShader);effectFocus.uniforms.screenWidth.value=1E3;effectFocus.uniforms.screenHeight.value=600;effectFXAA=new THREE.ShaderPass(THREE.FXAAShader);effectFXAA.uniforms.resolution.value=new THREE.Vector2(0.001,
1/600);b=new THREE.BloomPass(1.5);depthTarget=new THREE.WebGLRenderTarget(1E3,600,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat});var e=new THREE.ShaderPass(THREE.SSAOShader);e.uniforms.tDepth.value=depthTarget;e.uniforms.size.value.set(1E3,600);e.uniforms.cameraNear.value=h.near;e.uniforms.cameraFar.value=h.far;e=new THREE.ShaderPass(THREE.CopyShader);e.renderToScreen=!0;j=new THREE.EffectComposer(i);j.setSize(1E3,600);window.co=j;j.addPass(a);j.addPass(effectFXAA);
j.addPass(b);j.addPass(e)};this.start=function(){var b=THREE.ShaderLib.cube;b.uniforms.tCube.value=resource.getResource(levels.getLevel(g).background||"textures/bg1.png");b=new THREE.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:b.uniforms,depthWrite:!1,side:THREE.BackSide});b=new THREE.Mesh(new THREE.CubeGeometry(600,600,600),b);b.flipSided=!1;c.add(b);n=new Paddle(c,c.box2dworld);window.p=n;window.c=h;b=n.create(s,J);k.push(n);var e=a(s,-3.2,1.2256377722587917E7),
d=e.body,j=b.GetPosition().Copy();j.Subtract(new Box2D.Common.Math.b2Vec2(0,0));j.Normalize();j.Multiply(-1);d.ApplyImpulse(new Box2D.Common.Math.b2Vec2(-0.2,-0.05),d.GetWorldCenter());d.ApplyImpulse(j,d.GetWorldCenter());k.push(e);var d=e=null,j=0,i=levels.getLevel(g);x=[];for(var l=0,p=i.layout.length;l<p;l++){for(var e=i.firstBrickPosition.x,y=0,z=i.layout[l].length;y<z;y++){if(0!=i.layout[l][y]){null===d&&(d=i.firstBrickPosition.y);var m=new Brick(c,c.box2dworld);x.push(m.create(e,d,i.brickSize.x,
i.brickSize.y,i.types[i.layout[l][y]]));j+=i.types[i.layout[l][y]].hitCount||1}e+=i.brickSpace.x}d-=i.brickSpace.y}I=j;e=new b2BodyDef;e.type=b2Body.b2_staticBody;e.position.Set(0,0);e=c.box2dworld.CreateBody(e);e.userData={name:"wall"};d=new b2PolygonShape;j=new b2FixtureDef;j.shape=d;d.SetAsEdge(new b2Vec2(5,5),new b2Vec2(-5,5));e.CreateFixture(j).userData="top";d.SetAsEdge(new b2Vec2(-5,5),new b2Vec2(-5,-5));e.CreateFixture(j).userData="left";d.SetAsEdge(new b2Vec2(-5,-5),new b2Vec2(5,-5));e.CreateFixture(j);
d.SetAsEdge(new b2Vec2(5,-5),new b2Vec2(5,5));e.CreateFixture(j).userData="right";d=new b2Vec2(1,0);j=new b2PrismaticJointDef;j.Initialize(b,e,b.GetWorldCenter(),d);j.lowerTranslation=-4+s;j.upperTranslation=4+s;j.enableLimit=!0;j.maxMotorForce=1;j.motorSpeed=0;j.enableMotor=!0;c.box2dworld.CreateJoint(j);b=new THREE.PlaneGeometry(10,10);Math.random();e=new THREE.MeshPhongMaterial({color:levels.getLevel(g).planeColor||208966.07738840044,opacity:0.8,transparent:!0});b=new THREE.Mesh(b,e);b.position.set(0,
0,-0.2);b.castShadow=!1;b.receiveShadow=!0;c.add(b);ev.pub("game.levelObjectsCreated");b=new THREE.AmbientLight(1052688);c.add(b);pointLight=new THREE.PointLight(16755200);c.add(pointLight);pointLight.intensity=0.5;pointLight.position.x=1;pointLight.position.y=-8;pointLight.position.z=13;pointLight.intensity=1;pointLight.position.x=-400;b=new THREE.SpotLight(16777215,1,0,Math.PI,1);b.position.set(0,2,5);b.target.position.set(0,0,0);window.lo=pointLight;b.castShadow=!0;b.shadowCameraNear=1;b.shadowCameraFar=
10;b.shadowCameraFov=100;c.add(b);K||f();ev.pub("game.start")};this.reset=function(a,c){this.addPreRenderCb(function(){if(0<=m.length)for(var e=m.length-1;0<=e;e--)p.destroyBall(m[e]);c&&(l=!0);b();p.start();a&&a()})};this.cleanup=function(a){this.addPostRenderCb(function(){if(0<=m.length)for(var c=m.length-1;0<=c;c--)p.destroyBall(m[c]);b();a&&a()})};this.togglePause=function(a){this.addPreRenderCb(function(){(l=!l)?a&&a():p.addPostRenderCb(function(){a&&a()})})};this.resetBall=function(a){this.addPreRenderCb(function(){var c=
m[0].body;c.SetLinearVelocity(new Box2D.Common.Math.b2Vec2(0,0));n?c.SetPosition(new Box2D.Common.Math.b2Vec2(n.body.GetPosition().x,-3.5)):c.SetPosition(new Box2D.Common.Math.b2Vec2(s,-3.5));var b=n.body.GetPosition().Copy();b.Subtract(new Box2D.Common.Math.b2Vec2(0,0));b.Normalize();b.Multiply(-1);c.ApplyImpulse(b,c.GetWorldCenter());a&&p.addPostRenderCb(function(){a()});return!0})};this.resetPaddle=function(){s=0;J=-4;n.body.SetPosition(new Box2D.Common.Math.b2Vec2(0,-4))};this.createBonusBall=
function(c,b){var e=a(c,b,8485631.716873156);e.body.ApplyImpulse(new Box2D.Common.Math.b2Vec2((0.5>Math.random()?-1:1)*Math.random(),(0.5>Math.random()?-1:1)*Math.random()),e.body.GetWorldCenter())};this.destroyBall=function(a){c.remove(a.body.userData.guiref);c.box2dworld.DestroyBody(a.body);m.splice(m.indexOf(a),1);k.splice(k.indexOf(a),1)};this.getBallCount=function(){return m.length};this.getBalls=function(){return m};this.destroyBrick=function(a){C.push(a)};this.getBricks=function(){return x};
this.getPaddle=function(){return n};this.getCamera=function(){return h};this.setCameraLookAtMesh=function(a){u=a};this.cameraFollowsPaddle=function(a){y=a};this.setCameraAutoLookAt=function(){};this.setLevel=function(a){g=a};this.getComposer=function(){return j};var z=[],D=[],E=[];this.tweenCamera=function(a,c,b){z.push({type:a,coords:c,cb:b})};this.tweenLookAtCamera=function(a,c,b){D.push({type:a,coords:c,cb:b})};this.tweenCameraLens=function(a,c,b){E.push({type:a,coords:c,cb:b})};this.resetTweenCamera=
function(){z=[];D=[];E=[]};var e;moveCameraSchedule=function(){z&&z.length&&(e=z[0],e.coords.yit||(e.coords.yit=0,null==e.coords.yStart&&(e.coords.yStart=h.position.y),null==e.coords.zStart&&(e.coords.zStart=h.position.z),null==e.coords.xStart&&(e.coords.xStart=h.position.x),null==e.coords.yTarget&&(e.coords.yTarget=h.position.y),null==e.coords.zTarget&&(e.coords.zTarget=h.position.z),null==e.coords.xTarget&&(e.coords.xTarget=h.position.x),null==e.coords.y&&(e.coords.y=0),null==e.coords.z&&(e.coords.z=
0),null==e.coords.x&&(e.coords.x=0),null!==e.coords.yTarget&&(e.coords.y=e.coords.yTarget-e.coords.yStart),null!==e.coords.zTarget&&(e.coords.z=e.coords.zTarget-e.coords.zStart),null!==e.coords.xTarget&&(e.coords.x=e.coords.xTarget-e.coords.xStart),e.coords.speed||(e.coords.speed=50)),h.position.y=e.type(e.coords.yit,e.coords.yStart,e.coords.y,e.coords.speed),h.position.z=e.type(e.coords.yit,e.coords.zStart,e.coords.z,e.coords.speed),h.position.x=e.type(e.coords.yit,e.coords.xStart,e.coords.x,e.coords.speed),
e.coords.yit==e.coords.speed&&(z.splice(0,1),e.cb&&e.cb()),e.coords.yit++);D&&D.length&&(e=D[0],e.coords.yit||(e.coords.yit=0,null==e.coords.yStart&&(e.coords.yStart=0),null==!e.coords.zStart&&(e.coords.zStart=0),null==!e.coords.xStart&&(e.coords.xStart=0),null==e.coords.y&&(e.coords.y=0),null==e.coords.z&&(e.coords.z=0),null==e.coords.x&&(e.coords.x=0),null!==e.coords.yTarget&&(e.coords.y=e.coords.yTarget-e.coords.yStart),null!==e.coords.zTarget&&(e.coords.z=e.coords.zTarget-e.coords.zStart),null!==
e.coords.xTarget&&(e.coords.x=e.coords.xTarget-e.coords.xStart),e.coords.speed||(e.coords.speed=50)),h.lookAt({y:e.type(e.coords.yit,e.coords.yStart,e.coords.y,e.coords.speed),z:e.type(e.coords.yit,e.coords.zStart,e.coords.z,e.coords.speed),x:e.type(e.coords.yit,e.coords.xStart,e.coords.x,e.coords.speed)}),e.coords.yit==e.coords.speed&&(D.splice(0,1),e.cb&&e.cb()),e.coords.yit++);E&&E.length&&(e=E[0],e.coords.yit||(e.coords.yit=0,null==e.coords.start&&(e.coords.start=0),null==e.coords.target&&(e.coords.target=
0),null==e.coords.change&&(e.coords.change=e.coords.target-e.coords.start),e.coords.speed||(e.coords.speed=50)),h.setLens(e.type(e.coords.yit,e.coords.start,e.coords.change,e.coords.speed)),e.coords.yit==e.coords.speed&&(E.splice(0,1),e.cb&&e.cb()),e.coords.yit++)};this.getScene=function(){return c};var G,H,r,q,w,L=function(a){G=a.GetFixtureA();H=a.GetFixtureB();r=G.GetBody();q=H.GetBody();brick=w=null;r.userData&&"ball"==r.userData.name&&q.userData&&"brick"==q.userData.name?(w=r,brick=q):q.userData&&
("ball"==q.userData.name&&r.userData&&"brick"==r.userData.name)&&(w=q,brick=r);w&&brick&&ev.pub("game.brickPreHit",{contact:a,bricksLeft:I,brick:brick,ball:w})},C=[],A=[];this.addPreRenderCb=function(a){A.push(a)};var B=[];this.addPostRenderCb=function(a){B.push(a)};var v,F,K=!1};bricks3d.resources={};
Resources=function(){var a={},b=new THREE.JSONLoader,d="music/JAHOOR.ogg;music/game over.ogg;music/leveleen.ogg;music/leveldrie.ogg;music/level hakken.ogg;music/GEFORCE.ogg;music/DJCLANTM.ogg;music/russia.mp3;music/hit2.ogg;music/hit.ogg;music/bonus1.ogg;music/bonus2.ogg;music/bonus3.ogg;music/alarm.ogg".split(";"),f=["models/object.js"],g=[{name:"textures/bg1.png",maps:"textures/bg1.png textures/bg1.png textures/bg1.png textures/bg1.png textures/bg1.png textures/bg1.png".split(" ")},{name:"textures/bg2.png",
maps:"textures/bg2.png textures/bg2.png textures/bg2.png textures/bg2.png textures/bg2.png textures/bg2.png".split(" ")},{name:"textures/bg3.png",maps:"textures/bg3.png textures/bg3.png textures/bg3.png textures/bg3.png textures/bg3.png textures/bg3.png".split(" ")},{name:"textures/bg4.png",maps:"textures/bg4.png textures/bg4.png textures/bg4.png textures/bg4.png textures/bg4.png textures/bg4.png".split(" ")},{name:"textures/bg5.png",maps:"textures/bg5.png textures/bg5.png textures/bg5.png textures/bg5.png textures/bg5.png textures/bg5.png".split(" ")}],
h=d.length+f.length+g.length,c=function(c,b){if(!window.AudioContext||!window.webkitAudioContext)b();else{var d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=function(){audioContext.decodeAudioData(d.response,function(d){a[c]=d;b()},void 0)};d.addEventListener("progress",function(a){l(c,a.loaded/a.total)},!1);d.send()}},i=function(c,d){b.load(c,function(b){l(c,1);a[c]=b;d()})},j=function(c,b,d){var f=THREE.ImageUtils.loadTextureCube(b,null,function(){l(c,1);a[c]=f;d()})},
k=[],l=function(a,c){k[a]=c;var b=0,d;for(d in k)b+=k[d];document.getElementById("loadingText").innerHTML="Loading "+Math.round(100*(b/h))+"%";b==h&&(document.getElementById("loadingText").innerHTML="Please wait....")};this.getResource=function(c){return a[c]};this.loadResources=function(a){for(var b=0,l=function(){b++;b==h&&(document.getElementById("loadingContainer").style.display="none",a())},k=0;k<d.length;k++)c(d[k],function(){l()});for(k=0;k<f.length;k++)i(f[k],function(){l()});for(k=0;k<g.length;k++)j(g[k].name,
g[k].maps,function(){l()})}};bricks3d.sound={};
var Sound=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext;if(AudioContext){var a=new AudioContext;window.audioContext=a}var b,d={};this.playSound=function(a){if(!d[a]){var f=resource.getResource(a);f&&(b=audioContext.createBufferSource(),b.buffer=f,b.connect(audioContext.destination),b.start(0),d[a]=!0,setTimeout(function(){delete d[a]},20))}};var f={};this.playTheme=function(){if(a){f.theme&&f.theme.stop(0);g&&g.stop(0);var c=resource.getResource("music/JAHOOR.ogg");c&&
(b=audioContext.createBufferSource(),b.buffer=c,b.connect(audioContext.destination),b.loop=!0,f.theme=b,b.start(0))}};var g;this.playCredits=function(){if(a){f.theme&&f.theme.stop(0);g&&g.stop(0);var c=resource.getResource("music/JAHOOR.ogg");c&&(b=audioContext.createBufferSource(),b.buffer=c,b.connect(audioContext.destination),b.loop=!0,b.start(0),g=b)}};var h;this.playGameOver=function(){if(a){f.theme&&f.theme.stop(0);g&&g.stop(0);var c=resource.getResource("music/game over.ogg");c&&(b=audioContext.createBufferSource(),
b.buffer=c,b.connect(audioContext.destination),b.loop=!0,b.start(0),h=b)}};this.stopLevelMusic=function(c){a&&f[c]&&f[c].stop(0)};this.playLevelMusic=function(c){if(a){f[c]&&f[c].stop(0);g&&g.stop(0);h&&h.stop(0);f[c-1]&&f[c-1].stop(0);f.theme&&f.theme.stop(0);var d=resource.getResource(levels.getLevel(c).music);d&&(b=audioContext.createBufferSource(),b.buffer=d,b.connect(audioContext.destination),b.loop=!0,f[c]=b,b.start(0))}}};bricks3d.tween={};var Tween={easeInQuad:function(a,b,d,f){return d*(a/=f)*a+b},linear:function(a,b,d,f){return a/f*d+b},easeOutQuad:function(a,b,d,f){return-d*(a/=f)*(a-2)+b},easeInOutQuad:function(a,b,d,f){return 1>(a/=f/2)?d/2*a*a+b:-d/2*(--a*(a-2)-1)+b}};bricks3d.util={};ev={};
ev={subs:[],subsIndex:[],published:{},sub:function(a,b){var d=ev.subsIndex.indexOf(a);-1==d&&(ev.subsIndex.push(a),ev.subs.push([]),d=ev.subsIndex.length-1);ev.subs[d].push({to:a,cb:b})},pub:function(a,b){var d,f=ev.subsIndex.indexOf(a);ev.published[a]=b||!0;if(-1==f)return null;d=0;for(len=ev.subs[f].length;d<len;d++)ev.subs[f][d].cb(b)},unsub:function(a){var b=ev.subsIndex.indexOf(a);ev.subsIndex.indexOf(a);-1!=b&&(ev.subs[b]=[],ev.subsIndex[a]=[])},executeAfter:function(a,b){ev.published[a]?b(ev.published[a]):
ev.sub(a,b)}};
Color=function(a,b,d){var f;this.getR=function(){return this.r};this.setR=function(a){this.r=a;this.computeHSV()};this.getG=function(){return this.g};this.setG=function(a){this.g=a;this.computeHSV()};this.getB=function(){return this.b};this.setB=function(a){this.b=a;this.computeHSV()};this.getH=function(){return this.h};this.setH=function(a){this.h=a;this.computeRGB()};this.getS=function(){return this.s};this.setS=function(a){this.s=a;this.computeRGB()};this.getV=function(){return this.v};this.setV=
function(a){this.v=a;this.computeRGB()};var g=function(a){return parseInt(a,16)};this.setValue=function(a){"#"===a.substr(0,1)?(this.r=g(a.substr(1,2)),this.g=g(a.substr(3,2)),this.b=g(a.substr(5,2))):(a=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.exec(a),this.r=parseInt(a[1]),this.g=parseInt(a[2]),this.b=parseInt(a[3]));this.computeHSV()};this.getValue=function(){return"#"+((16>this.r?"0":"")+this.r.toString(16))+((16>this.g?"0":"")+this.g.toString(16))+((16>this.b?"0":"")+this.b.toString(16))};
this.computeHSV=function(){var a=this.r/255,c=this.g/255,b=this.b/255,d=Math.min(a,c,b),f=Math.max(a,c,b),d=f-d,g=0,n=0;0!=f?(n=d/f,g=60*(d?a==f?(c-b)/d:c==f?2+(b-a)/d:4+(a-c)/d:0),0>g&&(g+=360)):(n=0,g=-1);this.h=g;this.s=n;this.v=f};this.computeRGB=function(){var a=this.h,c=this.s,b=this.v,d=0,g=0,l=0,n=0,d=g=0;if(0==c)f=d=l=b;else switch(a=a%360/60,d=Math.floor(a),g=a-d,l=b*(1-c),n=b*(1-c*g),g=b*(1-c*(1-g)),d){case 0:f=b;d=g;break;case 1:f=n;d=b;break;case 2:f=l;d=b;l=g;break;case 3:f=l;d=n;l=
b;break;case 4:f=g;d=l;l=b;break;default:f=b,d=l,l=n}this.r=Math.round(255*f);this.g=Math.round(255*d);this.b=Math.round(255*l)};"string"==typeof a?this.setValue(a):("number"==typeof a?(this.r=a,this.g=b,this.b=d):this.b=this.g=this.r=0,this.computeHSV())};
(function(){for(var a=0,b=["ms","moz","webkit","o"],d=0;d<b.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[b[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[d]+"CancelAnimationFrame"]||window[b[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var d=(new Date).getTime(),h=Math.max(0,16-(d-a)),c=window.setTimeout(function(){b(d+h)},h);a=d+h;return c});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();bricks3d.levels={};
levels=function(){var a=[];a.push({type:"align",background:"textures/bg1.png",gameSize:{x:5,y:5},music:"music/leveleen.ogg",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.47,y:0.22,z:0.22},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},5:{color:1.53461601086433E7,type:"superspeed"},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},6:{color:1.93461601086433E7,type:"ghost"},7:{color:934446.7959924,type:"normal",
hitCount:3,onHitTransformTo:4}},layout:[[1,1,1,2,1,1,1],[1,1,1,1,1,1,1],[7,1,4,2,4,1,7],[5,5,1,1,1,5,5],[1,1,1,7,1,1,1],[1,1,1,1,1,1,1],[0,1,1,2,1,1,0],[0,0,1,1,1,0,0]]});Math.random();a.push({type:"align",background:"textures/bg2.png",planeColor:208966.07738840044,gameSize:{x:5,y:5},music:"music/leveleen.ogg",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.47,y:0.22,z:0.22},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},5:{color:1.53461601086433E7,
type:"superspeed"},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},6:{color:1.93461601086433E7,type:"ghost"},7:{color:934446.795992431,type:"normal",hitCount:3,onHitTransformTo:4},8:{color:1860824.026639538,type:"normal"}},layout:[[0,1,1,2,1,1,0],[0,1,8,8,8,1,0],[0,1,1,1,1,1,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]]});a.push({type:"align",gameSize:{x:5,y:5},background:"textures/bg4.png",planeColor:26112,music:"music/russia.mp3",firstBrickPosition:{x:-3,
y:2.4},brickSize:{x:0.47,y:0.22,z:0.22},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},5:{color:1.53461601086433E7,type:"superspeed"},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},6:{color:1.93461601086433E7,type:"ghost"}},layout:[[1,5,1,5,1,5,1],[1,1,1,2,1,1,1],[1,1,2,6,2,1,1],[1,1,1,1,1,1,1],[0,0,1,1,1,0,0],[0,0,4,4,4,0,0],[0,0,1,1,1,0,0]]});a.push({type:"align",background:"textures/bg3.png",planeColor:9043968,
gameSize:{x:5,y:5},music:"music/leveldrie.ogg",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.49,y:0.25,z:0.25},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},3:{color:8485631.716873156,type:"normal",hitCount:3,onHitTransformTo:4},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},5:{color:1.1808294026639538E7,type:"normal"},6:{color:1.53461601086433E7,type:"superspeed"},7:{color:934446.795992431,type:"normal",
hitCount:3,onHitTransformTo:4}},layout:[[1,6,6,1,6,6,1],[1,6,6,1,6,6,1],[1,6,6,1,6,6,1],[2,3,2,2,2,3,2],[7,7,7,7,7,7,7],[4,4,4,4,4,4,4],[5,5,5,5,5,5,5]]});a.push({type:"align",gameSize:{x:5,y:5},background:"textures/bg5.png",music:"music/DJCLANTM.ogg",planeColor:7997750,firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.49,y:0.25,z:0.25},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},3:{color:8157503.589997533,type:"normal"},4:{color:1274646.795992431,
type:"normal"},5:{color:6.1838294026639536E7,type:"normal"}},layout:[[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[2,0,2,0,2,0,2],[3,0,3,0,3,0,3],[4,0,4,0,4,0,4],[5,0,5,0,5,0,5]]});a.push({type:"align",gameSize:{x:5,y:5},music:"music/GEFORCE.ogg",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.24,y:0.12,z:0.12},brickSpace:{x:0.5,y:0.27},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},5:{color:1.53461601086433E7,type:"superspeed"},4:{color:4274646.795992431,
type:"normal",hitCount:2,onHitTransformTo:1},6:{color:1.93461601086433E7,type:"ghost"},7:{color:934446.795992431,type:"normal",hitCount:3,onHitTransformTo:4},8:{color:1860824.026639538,type:"normal"}},layout:[[7,7,7,7,7,7,2,2,7,7,7,7,7,7],[1,1,1,1,1,1,2,2,1,1,1,1,1,0],[0,0,1,1,1,1,4,4,1,1,1,1,0,0],[0,0,0,1,1,1,2,2,1,0,1,0,0,0],[0,0,0,0,1,1,4,4,1,1,0,0,0,0],[0,0,0,0,0,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,6,6,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,0,0,
0,0,0],[0,0,0,0,1,1,2,2,1,1,0,0,0,0],[0,0,0,1,1,1,2,2,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,0,0],[0,7,7,7,7,7,7,7,7,7,7,7,7,0]]});return{getLevel:function(b){return a[b]}}}();bricks3d.gameobject={};function GameObject(){this.body=null;this.sync=function(){this.body.userData.guiref.position.x=this.body.GetPosition().x;this.body.userData.guiref.position.y=this.body.GetPosition().y};this.validate=function(){};this.destroy=function(){}};bricks3d.ball={};
function Ball(a,b){this.maxSpeed=5;this.create=function(d,g,h){var c=new THREE.SphereGeometry(0.2,32,8);c.dynamic=!0;h=h||16777215*Math.random();material=new THREE.MeshPhongMaterial({color:h,shininess:100});h=new THREE.Mesh(c,material);h.castShadow=!0;this.mesh=h;a.add(h);c=new b2BodyDef;c.type=b2Body.b2_dynamicBody;c.position.x=d;c.position.y=g;d=b.CreateBody(c);d.userData={name:"ball",guiref:h};g=new b2FixtureDef;g.density=1;g.friction=0;g.restitution=1;g.shape=new b2CircleShape(0.2);d.CreateFixture(g);
return this.body=d};this.maintainSpeed=function(){var a=this.body,b=a.GetLinearVelocity().Length(),d=this.maxSpeed;b>d?a.SetLinearDamping(0.9):b<=d&&a.SetLinearDamping(0);b<d&&(b=a.GetLinearVelocity(),b.Set(1.05*b.x,1.05*b.y),a.ApplyForce(b,a.GetWorldCenter()),a.SetLinearDamping(0))};this.sync=function(){this.body.userData.guiref.position.x=this.body.GetPosition().x;this.body.userData.guiref.position.y=this.body.GetPosition().y;this.maintainSpeed()};var d=!1;this.validate=function(){-4.5<this.body.GetPosition().y&&
(d=!1);!d&&-4.5>this.body.GetPosition().y&&(d=!0,ev.pub("game.ball.dies",this))}}Ball.prototype=new GameObject;Ball.prototype.constructor=GameObject;bricks3d.paddle={};
function Paddle(a,b){var d=0.01;this.mesh=null;var f=!1,g=!1,h=function(a){if(37==a.keyCode||65==a.keyCode)g=!0;else if(39==a.keyCode||68==a.keyCode)f=!0},c=function(a){if(37==a.keyCode||65==a.keyCode)g=!1;else if(39==a.keyCode||68==a.keyCode)f=!1},i;this.updateControls=function(){var a=0;f&&++a;g&&--a;i=a;0<i?(this.body.ApplyImpulse(new Box2D.Common.Math.b2Vec2(6.2,0),this.body.GetWorldCenter()),d+=i/100,0>d&&(d+=i/60)):0>i&&(this.body.ApplyImpulse(new Box2D.Common.Math.b2Vec2(-6.2,0),this.body.GetWorldCenter()),
d+=i/100,0<d&&(d+=i/60))};this.create=function(d,f){mesh=new THREE.Mesh(resource.getResource("models/object.js"),new THREE.MeshPhongMaterial({color:2232323}));mesh.scale.set(1,1,1);mesh.rotation.x=1.4;mesh.position.x=d;mesh.position.y=f;a.add(mesh);this.mesh=mesh;var g=new b2FixtureDef;g.density=11;g.friction=50;g.linearDamping=1005;g.restitution=0;var i=new b2BodyDef;i.type=b2Body.b2_dynamicBody;bodyPoly=new b2PolygonShape;g.shape=bodyPoly;var m=[];m.push(new b2Vec2(-0,-0.3));m.push(new b2Vec2(0.7,
-0.1));m.push(new b2Vec2(0.6,0.2));m.push(new b2Vec2(0.2,0.3));m.push(new b2Vec2(-0.2,0.3));m.push(new b2Vec2(-0.6,0.2));m.push(new b2Vec2(-0.7,-0.1));bodyPoly.SetAsArray(m,m.length);i.position.x=d;i.position.y=f;i=b.CreateBody(i);i.CreateFixture(g);i.SetLinearDamping(5.9);this.body=i;this.body.userData={name:"paddle",guiref:this.mesh};document.addEventListener("keydown",h);document.addEventListener("keyup",c);return this.body};this.sync=function(){this.body.userData.guiref.position.x=this.body.GetPosition().x;
this.body.userData.guiref.position.y=this.body.GetPosition().y}}Paddle.prototype=new GameObject;Paddle.prototype.constructor=GameObject;bricks3d.brick={};
function Brick(a,b){this.create=function(d,f,g,h,c){var i=new THREE.MeshPhongMaterial({color:c.color,shininess:50,opacity:1,transparent:!0}),j=new THREE.CubeGeometry(2*g,2*h,0.5),i=new THREE.Mesh(j,i);i.position.z=0;i.position.x=d;i.position.y=f;i.receiveShadow=!1;i.castShadow=!0;i.matrixAutoUpdate=!0;a.add(i);a.add(i);j=new b2FixtureDef;j.density=11;j.restitution=0;var k=new b2BodyDef;k.type=b2Body.b2_staticBody;j.shape=new b2PolygonShape;j.shape.SetAsBox(g,h);k.position.x=d;k.position.y=f;d=b.CreateBody(k);
d.CreateFixture(j);d.SetLinearDamping(5.9);d.userData={name:"brick",guiref:i,type:c,hitCount:c.hitCount||1};return d};this.sync=function(){this.body.userData.guiref.position.x=this.body.GetPosition().x;this.body.userData.guiref.position.y=this.body.GetPosition().y}}Brick.prototype=new GameObject;Brick.prototype.constructor=GameObject;var resource=new Resources,game=function(){function a(){function a(){l.currentState!=k.gameover&&l.currentState!=k.demo||(b.style.opacity=Tween.easeInOutQuad(g,c,d,f),g++,g%=2*f,setTimeout(function(){a()},20))}var b=document.getElementById("startTitle"),c=1,d=-1,f=20,g=0;a();var h=function(a){13==a.keyCode&&(l.startGame(),document.removeEventListener("keyup",h,!1))};document.addEventListener("keyup",h)}function b(){ev.unsub("game.paddleHit");ev.unsub("game.brickPreHit");ev.unsub("game.brickHit");
ev.unsub("game.ball.dies");ev.unsub("game.ball.created");ev.unsub("game.start");ev.unsub("game.levelObjectsCreated");ev.unsub("game.wallCollition")}if(!Detector.webgl)return document.getElementById("loadingContainer").innerHTML="",document.getElementById("loadingContainer").appendChild(Detector.getWebGLErrorMessage());var d=1,f=3,g=0,h=1,c=new BrickGame,i=new Hud,j=new Sound,k={demo:1,playing:2,gameover:3,credits:4},l={currentState:null,startDemo:function(){l.currentState=k.demo;j.playTheme();document.getElementById("splashContainer").style.display=
"block";document.getElementById("startTitle").style.opacity=0;var b=function(){a()},i=function(){u!=p&&c.addPreRenderCb(function(){c.getComposer().passes[2].copyUniforms.opacity.value=Tween.easeInOutQuad(u,1.4,-0.4,p);u++;i()})};demo=!0;d=0;f=3;g=0;ev.sub("game.ball.dies",function(a){1==c.getBallCount()&&!f?(g=d=0,h=1,c.setLevel(d),c.reset(function(){x(function(){c.togglePause()})},!0),f=3):1==c.getBallCount()?(f--,h=1,c.resetBall()):c.addPreRenderCb(function(){c.destroyBall(a)})});ev.sub("game.brickHit",
function(a){var b=100*h;g+=b;h+=1;if("extraBalls"==a.brick.userData.type.type)c.addPreRenderCb(function(){c.createBonusBall(3,3);c.createBonusBall(-3,3)});else if("bigBall"==a.brick.userData.type.type)a.ball.userData.guiref.scale.x=1,a.ball.userData.guiref.scale.y=1,a.ball.userData.guiref.scale.z=1;else if("superspeed"==a.brick.userData.type.type){var f=a.ball.GetLinearVelocity(),i=2*f.x,f=2*f.y,i=0>i?Math.max(i,-15):Math.min(i,15),f=0>f?Math.max(f,-15):Math.min(f,15);a.ball.SetLinearVelocity(new b2Vec2(i,
f))}brick.userData.hitCount?m({brick:a.brick,score:b,enableBrickFadeOut:!1},function(){}):m({brick:a.brick,score:b,enableBrickFadeOut:!0},function(a){c.destroyBrick(a)});a.bricksLeft||(c.setLevel(d),c.togglePause(function(){c.reset(function(){x(function(){c.togglePause()})},!0)}))});ev.sub("game.brickPreHit",function(a){"ghost"==a.brick.userData.type.type&&(a.contact.SetEnabled(!1),a.ball.userData.isGhost=!0,a.ball.userData.guiref.material.opacity=0.5,setTimeout(function(){a.ball.userData.guiref.material.opacity=
1;a.contact.SetEnabled(!0);a.ball.userData.isGhost=!1},5E3));a.ball.userData.isGhost&&a.contact.SetEnabled(!1)});ev.sub("game.paddleHit",function(){h=1});var p=100,u=0;i();c.setLevel(d);c.start();c.setCameraLookAtMesh({position:{x:0,y:-2,z:0}});c.tweenCameraLens(Tween.easeInOutQuad,{start:10,target:25,speed:200});c.tweenCamera(Tween.easeOutQuad,{yStart:-7,yTarget:-6,zStart:4,zTarget:2,xTarget:4,speed:200},function(){function a(){c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:5,speed:1500});
c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-6,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:-5,zTarget:3,xTarget:-5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-5,speed:1500},function(){a()})}c.tweenCameraLens(Tween.easeInOutQuad,{start:25,target:19,speed:300});a()});n(1,-1,function(){});c.cameraFollowsPaddle(!1);c.reset(function(){for(var d=function(){if(l.currentState==k.demo){for(var a=0,b=f.length;a<b;a++)f[a].position.z+=f[a].position.speedz,
f[a].position.x+=f[a].position.speedx,f[a].position.y+=f[a].position.speedy,50<f[a].position.z&&(f[a].position.z=-50,f[a].position.z=-50);c.addPreRenderCb(function(){d()})}},f=[],g=[1.581393358085355E7,6100182.730150754,4326982.82802921,1467844.0140721737,2028035.0978696812,1.1345698050306158E7],h=0;50>h;h++){var e=new THREE.SphereGeometry(5,32,32);e.dynamic=!1;material=new THREE.MeshPhongMaterial({color:g[Math.floor(Math.random()*g.length)],shininess:66,opacity:0.3,transparent:!0});e=new THREE.Mesh(e,
material);e.useQuaternion=!0;e.receiveShadow=!0;e.castShadow=!0;e.position.y=100*Math.random()*(0.5>Math.random()?-1:1);e.position.x=100*Math.random()*(0.5>Math.random()?-1:1);e.position.z=100*Math.random()*(0.5>Math.random()?-1:1);e.position.speedz=0.3*Math.random();e.position.speedx=0.1*Math.random()*(0.5>Math.random()?-1:1);e.position.speedy=0.1*Math.random()*(0.5>Math.random()?-1:1);f.push(e);c.getScene().add(e)}c.addPreRenderCb(function(){d()});c.togglePause(function(){x(function(){c.togglePause();
var d=function(){if(s){var a=0,b=0;if(c.getBalls().length){for(var e=c.getBalls(),f,g=0;g<e.length;g++)f||(f=e[g]),f.body.GetPosition().y>e[g].body.GetPosition().y&&(f=e[g]);e=f.body.GetPosition().x-c.getPaddle().body.GetPosition().x;0.4<e?(a++,b=0,c.getPaddle().body.ApplyImpulse(new Box2D.Common.Math.b2Vec2(6.2,0),c.getPaddle().body.GetWorldCenter())):-0.4>e&&(b++,a=0,c.getPaddle().body.ApplyImpulse(new Box2D.Common.Math.b2Vec2(-6.2,0),c.getPaddle().body.GetWorldCenter()))}setTimeout(function(){s&&
d()},20)}};s=!0;d();b&&a()})})})},startGameover:function(){j.stopLevelMusic(d);j.playGameOver();l.clearPreviousState(function(){l.currentState=k.gameover;c.togglePause();n(0,1,function(){function b(){f==d?a():c.addPreRenderCb(function(){c.getComposer().passes[2].copyUniforms.opacity.value=Tween.easeInOutQuad(f,2,-0.5,d);f++;b()})}c.resetPaddle();var d=100,f=0;b();document.getElementById("gameoverTitle").style.display="block";i.clear();c.setCameraLookAtMesh({position:{x:0,y:-2,z:0}});c.cameraFollowsPaddle(!1);
c.tweenCamera(Tween.easeOutQuad,{yTarget:-6,zTarget:2,xTarget:-4,speed:200},function(){function a(){c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:6,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:-5,zTarget:3,xTarget:-5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-5,speed:1500},function(){a()})}c.tweenCameraLens(Tween.easeInOutQuad,{start:25,target:19,speed:300});
a()});n(1,-1,function(){})})})},startGame:function(){l.clearPreviousState(function(){l.currentState=k.playing;document.getElementById("gameoverTitle").style.display="none";document.getElementById("startTitle").style.opacity=0;d=1;f=3;g=0;ev.sub("game.start",function(){i.drawGameStatistics(g,d,f)});ev.sub("game.levelObjectsCreated",function(){c.resetPaddle();j.playLevelMusic(d);c.tweenCamera(Tween.easeInOutQuad,{yTarget:-7,zTarget:6})});ev.sub("game.wallCollition",function(){j.playSound("music/hit2.ogg")});
ev.sub("game.ball.created",function(){2==c.getBallCount()&&c.tweenCamera(Tween.easeInOutQuad,{yTarget:-7,zTarget:8})});ev.sub("game.ball.dies",function(a){if(1==c.getBallCount()&&!f)return l.startGameover();1==c.getBallCount()?(f--,h=1,i.drawGameStatistics(g,d,f),c.resetBall(function(){c.togglePause(function(){setTimeout(function(){c.togglePause()},1E3)})})):c.addPreRenderCb(function(){c.destroyBall(a);1==c.getBallCount()&&c.tweenCamera(Tween.easeInOutQuad,{yTarget:-7,zTarget:6})})});ev.sub("game.brickHit",
function(a){var b=100*h;g+=b;i.drawGameStatistics(g,d,f);h+=1;if("extraBalls"==a.brick.userData.type.type)j.playSound("music/bonus1.ogg"),c.addPreRenderCb(function(){c.createBonusBall(3,3);c.createBonusBall(-3,3)});else if("bigBall"==a.brick.userData.type.type)a.ball.userData.guiref.scale.x=1,a.ball.userData.guiref.scale.y=1,a.ball.userData.guiref.scale.z=1;else if("superspeed"==a.brick.userData.type.type){j.playSound("music/alarm.ogg");var p=a.ball.GetLinearVelocity(),k=2*p.x,p=2*p.y,k=0>k?Math.max(k,
-15):Math.min(k,15),p=0>p?Math.max(p,-15):Math.min(p,15);a.ball.SetLinearVelocity(new b2Vec2(k,p))}else"ghost"==a.brick.userData.type.type?j.playSound("music/bonus3.ogg"):j.playSound("music/hit.ogg");brick.userData.hitCount?m({brick:a.brick,score:b,enableBrickFadeOut:!1},function(){}):m({brick:a.brick,score:b,enableBrickFadeOut:!0},function(a){c.destroyBrick(a)});if(!a.bricksLeft){d++;if(!levels.getLevel(d))return j.stopLevelMusic(d-1),l.startCredits();c.setLevel(d);c.togglePause(function(){c.setCameraLookAtMesh(null);
c.cameraFollowsPaddle(!1);var b=a.brick,h=function(){c.togglePause(function(){c.reset(function(){c.resetPaddle();c.resetBall();c.setCameraLookAtMesh(c.getPaddle().mesh);c.cameraFollowsPaddle(!0);x(function(){i.drawGameStatistics(g,d,f);c.togglePause()})},!0)})},j=function(){n(0,1,function(){n(1,-1,function(){})})},l=c.getPaddle().mesh.position.x,e=c.getPaddle().mesh.position.z,k=c.getPaddle().mesh.position.y,p=b.GetPosition().x;b.GetPosition();var m=b.GetPosition().y;c.getCamera();var q=c.getCamera().position.y,
u=c.getCamera().position.z;c.tweenCamera(Tween.easeInOutQuad,{yStart:q,yTarget:m-1,zStart:u,zTarget:2,xStart:l/1.3,xTarget:p,speed:20});c.tweenLookAtCamera(Tween.easeInOutQuad,{yStart:k+2,yTarget:m,zStart:e,zTarget:e,xStart:l,xTarget:p,speed:20},function(){c.tweenCamera(Tween.linear,{yStart:m-1,yTarget:m-1,zStart:2,zTarget:2,xStart:p,xTarget:p,speed:60},function(){j&&j();c.tweenCamera(Tween.easeInOutQuad,{yStart:m-1,yTarget:q,zStart:2,zTarget:u,xStart:p,xTarget:0,speed:20});c.tweenLookAtCamera(Tween.easeInOutQuad,
{yStart:m,yTarget:k+2,zStart:e,zTarget:e,xStart:p,xTarget:0,speed:20},function(){h&&h()})})})})}});ev.sub("game.brickPreHit",function(a){"ghost"==a.brick.userData.type.type&&(a.contact.SetEnabled(!1),a.ball.userData.isGhost=!0,a.ball.userData.guiref.material.opacity=0.5,setTimeout(function(){a.ball.userData.guiref.material.opacity=1;a.contact.SetEnabled(!0);a.ball.userData.isGhost=!1},5E3));a.ball.userData.isGhost&&a.contact.SetEnabled(!1)});ev.sub("game.paddleHit",function(){h=1});c.setLevel(d);
n(0,1,function(){c.reset(function(){c.setCameraLookAtMesh(c.getPaddle().mesh);c.cameraFollowsPaddle(!0);c.togglePause(function(){c.getCamera().setLens(25);c.getCamera().position.x=0;c.getCamera().position.y=-7;c.getCamera().position.z=2;x(function(){i.drawGameStatistics(g,d,f);c.togglePause()});n(1,-1,function(){});c.getComposer().passes[2].copyUniforms.opacity.value=0.7;c.tweenCamera(Tween.easeInOutQuad,{yTarget:-7,zTarget:6,xTarget:0})})})})})},startCredits:function(){l.currentState=k.credits;var a=
function(){p!=h&&c.addPreRenderCb(function(){c.getComposer().passes[2].copyUniforms.opacity.value=Tween.easeInOutQuad(p,1.4,-0.4,h);p++;a()})};document.getElementById("gameoverTitle").style.display="none";document.getElementById("startTitle").style.opacity=0;document.getElementById("splashContainer").style.display="none";j.playCredits();demo=!0;d=1;f=3;g=0;b();i.showCredits();setTimeout(function(){i.stopCredits();l.startDemo()},3E4);document.getElementById("credits").style.display="block";var h=100,
p=0;a();c.tweenCameraLens(Tween.easeInOutQuad,{start:10,target:25,speed:200});c.tweenCamera(Tween.easeOutQuad,{yStart:-7,yTarget:-6,zStart:4,zTarget:2,xTarget:4,speed:200},function(){function a(){c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-6,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:-5,zTarget:3,xTarget:-5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-5,speed:1500},
function(){a()})}c.tweenCameraLens(Tween.easeInOutQuad,{start:25,target:19,speed:300});a()});n(1,-1,function(){});c.cameraFollowsPaddle(!1)},clearPreviousState:function(a){l.currentState==k.demo?l.currentState!=k.demo?a():(document.getElementById("splashContainer").style.display="none",demo=s=demo=!1,c.resetTweenCamera(),b(),c.resetPaddle(),c.cleanup(a)):l.currentState==k.playing?a():l.currentState==k.gameover?(document.getElementById("gameoverTitle").style.display="none",document.getElementById("startTitle").style.opacity=
0,s=!1,c.resetTweenCamera(),b(),c.cleanup(a),c.togglePause()):a()}};resource.loadResources(function(){c.setLevel(d);c.init();l.startDemo()});var n=function(a,b,c){function d(){h==g?c&&c():(f.style.opacity=Tween.easeInOutQuad(h,a,b,g),h++,h%=2*g,setTimeout(function(){d()},20))}var f=document.getElementById("white"),g=20,h=0;d()},m=function(a,b){var f=a.brick,g=new THREE.TextGeometry(a.score,{size:0.3,height:0.05,curveSegments:4,font:"helvetiker",weight:"bold",style:"normal",material:0,extrudeMaterial:1});
g.computeBoundingBox();g.computeVertexNormals();var h=new THREE.MeshFaceMaterial([new THREE.MeshPhongMaterial({color:16777215,shading:THREE.SmoothShading,transparent:!0,opacity:0.8}),new THREE.MeshPhongMaterial({color:16777215,shading:THREE.SmoothShading,transparent:!0,opacity:0.8})]);textMesh1=new THREE.Mesh(g,h);textMesh1.position.x=f.GetPosition().x-0.3;textMesh1.position.y=f.GetPosition().y;textMesh1.position.z=0.5;textMesh1.rotation.x=1.7;parent=new THREE.Object3D;parent.castShadow=!0;parent.receiveShadow=
!1;if(c.getScene()){c.getScene().add(parent);parent.add(textMesh1);f.userData.hitCount?(f.userData.type=levels.getLevel(d).types[f.userData.type.onHitTransformTo],f.userData.guiref.material.color.set(f.userData.type.color)):c.addPreRenderCb(function(){f.SetActive(!1);f.userData.guiref.castShadow=!1;f.userData.guiref.material.color.setHex("0xffffff")});var i=textMesh1,j=parent,l=function(){c.addPreRenderCb(function(){var d=Tween.easeInQuad(k,1,-1,30);i.material.materials[0].opacity=d;i.material.materials[1].opacity=
d;i.scale.x+=e;i.scale.y+=e;a.enableBrickFadeOut&&(f.userData.guiref.material.opacity=d);c.addPostRenderCb(function(){30==k?(c.getScene().remove(j),b(f)):l();k++})})},e=0.02,k=0;l()}},x=function(a){function b(){c.addPreRenderCb(function(){for(var g=!0,e=0,h=d.length;e<h;e++)d[e].userData.guiref.material.opacity=1,d[e].userData.guiref.position.z-=f,0>d[e].userData.guiref.position.z?d[e].userData.guiref.position.z=0:g=!1;c.addPostRenderCb(function(){g?a():b()})})}for(var d=c.getBricks(),f=0.3,g=1,h=
0,i=d.length;h<i;h++)d[h].userData.guiref.position.z=4+g,d[h].userData.guiref.material.opacity=0,g+=0.7;b()},s=!0};
