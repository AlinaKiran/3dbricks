var COMPILED=!0,goog=goog||{};goog.global=this;goog.DEBUG=!0;goog.LOCALE="en";goog.evalWorksForGlobals_=null;goog.provide=function(a){if(!COMPILED){if(goog.getObjectByName(a)&&!goog.implicitNamespaces_[a])throw Error('Namespace "'+a+'" already declared.');for(var b=a;b=b.substring(0,b.lastIndexOf("."));)goog.implicitNamespaces_[b]=!0}goog.exportPath_(a)};COMPILED||(goog.implicitNamespaces_={});
goog.exportPath_=function(a,b,d){a=a.split(".");d=d||goog.global;!(a[0]in d)&&d.execScript&&d.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)!a.length&&goog.isDef(b)?d[e]=b:d=d[e]?d[e]:d[e]={}};goog.getObjectByName=function(a,b){for(var d=a.split("."),e=b||goog.global,h;h=d.shift();)if(e[h])e=e[h];else return null;return e};goog.globalize=function(a,b){var d=b||goog.global,e;for(e in a)d[e]=a[e]};
goog.addDependency=function(a,b,d){if(!COMPILED){for(var e,a=a.replace(/\\/g,"/"),h=goog.dependencies_,g=0;e=b[g];g++)h.nameToPath[e]=a,a in h.pathToNames||(h.pathToNames[a]={}),h.pathToNames[a][e]=!0;for(e=0;b=d[e];e++)a in h.requires||(h.requires[a]={}),h.requires[a][b]=!0}};
goog.require=function(a){if(!COMPILED&&!goog.getObjectByName(a)){var b=goog.getPathFromDeps_(a);if(b)goog.included_[b]=!0,goog.writeScripts_();else throw a="goog.require could not find: "+a,goog.global.console&&goog.global.console.error(a),Error(a);}};goog.basePath="";goog.nullFunction=function(){};goog.identityFunction=function(a){return a};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};
goog.addSingletonGetter=function(a){a.getInstance=function(){return a.instance_||(a.instance_=new a)}};
COMPILED||(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.inHtmlDocument_()){var a=goog.global.document;if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else for(var a=a.getElementsByTagName("script"),b=a.length-1;0<=b;--b){var d=a[b].src,e=d.length;if("base.js"==d.substr(e-7)){goog.basePath=
d.substr(0,e-7);break}}}},goog.writeScriptTag_=function(a){goog.inHtmlDocument_()&&!goog.dependencies_.written[a]&&(goog.dependencies_.written[a]=!0,goog.global.document.write('<script type="text/javascript" src="'+a+'"><\/script>'))},goog.writeScripts_=function(){function a(g){if(!(g in e.written)){if(!(g in e.visited)&&(e.visited[g]=!0,g in e.requires))for(var c in e.requires[g])if(c in e.nameToPath)a(e.nameToPath[c]);else if(!goog.getObjectByName(c))throw Error("Undefined nameToPath for "+c);g in
d||(d[g]=!0,b.push(g))}}var b=[],d={},e=goog.dependencies_,h;for(h in goog.included_)e.written[h]||a(h);for(h=0;h<b.length;h++)if(b[h])goog.writeScriptTag_(goog.basePath+b[h]);else throw Error("Undefined script input");},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.writeScriptTag_(goog.basePath+"deps.js"));
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array||!(a instanceof Object)&&"[object Array]"==Object.prototype.toString.call(a)||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if(!(a instanceof Object)&&("[object Function]"==Object.prototype.toString.call(a)||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call")))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.propertyIsEnumerableCustom_=function(a,b){if(b in a)for(var d in a)if(d==b&&Object.prototype.hasOwnProperty.call(a,b))return!0;return!1};goog.propertyIsEnumerable_=function(a,b){return a instanceof Object?Object.prototype.propertyIsEnumerable.call(a,b):goog.propertyIsEnumerableCustom_(a,b)};goog.isDef=function(a){return void 0!==a};goog.isNull=function(a){return null===a};
goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};
goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){a=goog.typeOf(a);return"object"==a||"array"==a||"function"==a};goog.getUid=function(a){if(a.hasOwnProperty&&a.hasOwnProperty(goog.UID_PROPERTY_))return a[goog.UID_PROPERTY_];a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_);return a[goog.UID_PROPERTY_]};goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};
goog.UID_PROPERTY_="closure_uid_"+Math.floor(2147483648*Math.random()).toString(36);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},d;for(d in a)b[d]=goog.cloneObject(a[d]);return b}return a};
goog.bind=function(a,b,d){var e=b||goog.global;if(2<arguments.length){var h=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(b,h);return a.apply(e,b)}}return function(){return a.apply(e,arguments)}};goog.partial=function(a,b){var d=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,d);return a.apply(this,b)}};
goog.mixin=function(a,b){for(var d in b)a[d]=b[d]};goog.now=Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,d=b.createElement("script");d.type="text/javascript";d.defer=!1;d.appendChild(b.createTextNode(a));b.body.appendChild(d);
b.body.removeChild(d)}else throw Error("goog.globalEval not available");};goog.typedef=!0;goog.getCssName=function(a,b){var d=a+(b?"-"+b:"");return goog.cssNameMapping_&&d in goog.cssNameMapping_?goog.cssNameMapping_[d]:d};goog.setCssNameMapping=function(a){goog.cssNameMapping_=a};goog.getMsg=function(a,b){var d=b||{},e;for(e in d)a=a.replace(RegExp("\\{\\$"+e+"\\}","gi"),d[e]);return a};goog.exportSymbol=function(a,b,d){goog.exportPath_(a,b,d)};goog.exportProperty=function(a,b,d){a[b]=d};
goog.inherits=function(a,b){function d(){}d.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new d;a.prototype.constructor=a};
goog.base=function(a,b,d){var e=arguments.callee.caller;if(e.superClass_)return e.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var h=Array.prototype.slice.call(arguments,2),g=!1,c=a.constructor;c;c=c.superClass_&&c.superClass_.constructor)if(c.prototype[b]===e)g=!0;else if(g)return c.prototype[b].apply(a,h);if(a[b]===e)return a.constructor.prototype[b].apply(a,h);throw Error("goog.base called from a method of one name to a method of a different name");};var bricks3d={hud:{}};
function Hud(){var a,b,d=function(){b.fillRect(0,0,1E3,600);b.clearRect(0,0,1E3,600)};this.drawGameStatistics=function(a,e,c){d();b.fillStyle="#ffffff";b.fillRect(0,560,1E3,40,0.5);b.fillStyle="#333333";b.font="normal 24pt sans-serif";b.fillText("score "+a,20,588);b.fillText("level "+e,880,588);a=20;for(e=0;e<c;e++)b.beginPath(),b.arc(a,20,12,0,2*Math.PI,!1),b.fillStyle="#777777",b.fill(),b.lineWidth=3,b.strokeStyle="#222222",b.stroke(),a+=28};var e=!1;this.showCredits=function(){function a(){e||(b-=
1,document.getElementById("creditsText").style.marginTop=b+"px",setTimeout(function(){a()},20))}e=!1;var b=634;document.getElementById("creditsText").style.display="block";a()};this.stopCredits=function(){e=!0;document.getElementById("creditsText").style.display="none"};this.clear=function(){d()};a=document.createElement("canvas");a.height=600;a.width=1E3;document.getElementById("2dcanvas").appendChild(a);b=a.getContext("2d");b.canvas.width=1E3;b.globalAlpha=0.5;b.canvas.height=600};bricks3d.brickgame={};
function BrickGame(){function a(a,b,f,d){var e=new Ball(c,c.box2dworld);e.create(a,b,f,d);m.push(e);k.push(e);ev.pub("game.ball.created",e);return e}function b(){for(var a=c.children.length-1;0<=a;a--)c.remove(c.children[a]);for(;a=c.box2dworld.GetBodyList().GetNext();)c.box2dworld.DestroyBody(a);k=[]}function d(a){H=a.GetFixtureA();I=a.GetFixtureB();q=H.GetBody();r=I.GetBody();if(q.userData&&"ball"==q.userData.name&&r.userData&&"brick"==r.userData.name)v=q,brick=r;else if(r.userData&&"ball"==r.userData.name&&
q.userData&&"brick"==q.userData.name)v=r,brick=q;else if(q.userData&&"paddle"==q.userData.name||r.userData&&"paddle"==r.userData.name){var c=null;q.userData&&"ball"==q.userData.name?c=q:r.userData&&"ball"==r.userData.name&&(c=r);if(c){var b=new Box2D.Collision.b2WorldManifold;a.GetWorldManifold(b);c.SetLinearVelocity(new b2Vec2(6*(b.m_points[0].x-s),4))}ev.pub("game.paddleHit",n)}v&&brick&&brick.userData.hitCount?(brick.userData.hitCount-=1,J--,ev.pub("game.brickHit",{bricksLeft:J,brick:brick,ball:v})):
ev.pub("game.wallCollition")}function e(){K=!0;u=0;for(len=C.length;u<len;u++)C[u].dirty=!0,C[u]();for(u=C.length-1;0<=u;u--)C[u].dirty&&C.splice(u,1);if(E.length){for(var a=0;a<E.length;a++)c.box2dworld.DestroyBody(E[a]),c.remove(E[a].userData.guiref);E=[]}for(G=0;G<k.length;G++)k[G].sync(),k[G].validate();j||(n.updateControls(),s=n.body.GetPosition().x,w=n.body.GetPosition().y,t=new Date,c.box2dworld.Step(1/60,10,10),c.box2dworld.ClearForces(),t2=new Date-t);p&&g.lookAt({x:p.position.x,y:p.position.y+
2,z:p.position.z});moveCameraSchedule();g.rotation.z=0;x&&(g.position.x=n.mesh.position.x/1.3);c.box2dworld.SetGravity(new b2Vec2((0-n.mesh.position.x)/6,-0.7));i.clear(!1,!0,!1);l.render(0.01);for(var a=0,b=D.length;a<b;a++)D[a].dirty=!0,D[a]();for(a=D.length-1;0<=a;a--)D[a].dirty&&D.splice(a,1);requestAnimationFrame(e)}var h,g,c,i,l,k=[],j=!1,n,m=[],z=[],s=0,w=-4,J=0,y=this,p;b2Vec2=Box2D.Common.Math.b2Vec2;b2AABB=Box2D.Collision.b2AABB;b2BodyDef=Box2D.Dynamics.b2BodyDef;b2Body=Box2D.Dynamics.b2Body;
b2FixtureDef=Box2D.Dynamics.b2FixtureDef;b2Fixture=Box2D.Dynamics.b2Fixture;b2World=Box2D.Dynamics.b2World;b2PolygonDef=Box2D.Dynamics.b2PolygonDef;b2MassData=Box2D.Collision.Shapes.b2MassData;b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape;b2CircleShape=Box2D.Collision.Shapes.b2CircleShape;b2DebugDraw=Box2D.Dynamics.b2DebugDraw;b2MouseJointDef=Box2D.Dynamics.Joints.b2MouseJointDef;b2PrismaticJointDef=Box2D.Dynamics.Joints.b2PrismaticJointDef;var x=!1;this.init=function(){g=new THREE.PerspectiveCamera(50,
1E3/600,1,1E3);g.position.z=1;g.position.x=0;g.position.y=-10;g.up={x:0,y:0,z:1};g.eulerOrder="XZY";g.lookAt({x:0,y:4,z:-4});c=new THREE.Scene;var a=new b2World(new b2Vec2(0,-1),!0);c.box2dworld=a;var b=new Box2D.Dynamics.b2ContactListener;b.BeginContact=d;b.PreSolve=L;a.SetContactListener(b);i=new THREE.WebGLRenderer;i.autoClear=!1;i.sortObjects=!0;i.shadowMapEnabled=!0;i.physicallyBasedShading=!0;i.shadowMapDarkness=0.5;i.shadowMapWidth=1024;i.shadowMapHeight=1024;i.setClearColor(16777215,0);i.setSize(1E3,
600);document.getElementById("3dcanvas").appendChild(i.domElement);a=new THREE.RenderPass(c,g);a.clearColor=1118481;a.clearAlpha=0;(new THREE.FilmPass(0.01,0.1,448,!1)).renderToScreen=!0;effectFocus=new THREE.ShaderPass(THREE.FocusShader);effectFocus.uniforms.screenWidth.value=1E3;effectFocus.uniforms.screenHeight.value=600;effectFXAA=new THREE.ShaderPass(THREE.FXAAShader);effectFXAA.uniforms.resolution.value=new THREE.Vector2(0.001,1/600);b=new THREE.BloomPass(1.5);depthTarget=new THREE.WebGLRenderTarget(1E3,
600,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat});var f=new THREE.ShaderPass(THREE.SSAOShader);f.uniforms.tDepth.value=depthTarget;f.uniforms.size.value.set(1E3,600);f.uniforms.cameraNear.value=g.near;f.uniforms.cameraFar.value=g.far;f=new THREE.ShaderPass(THREE.CopyShader);f.renderToScreen=!0;l=new THREE.EffectComposer(i);l.setSize(1E3,600);window.co=l;l.addPass(a);l.addPass(effectFXAA);l.addPass(b);l.addPass(f)};this.start=function(){var b=THREE.ShaderLib.cube;
b.uniforms.tCube.value=resource.getResource(levels.getLevel(h).background||"textures/bg1.png");b=new THREE.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:b.uniforms,depthWrite:!1,side:THREE.BackSide});b=new THREE.Mesh(new THREE.CubeGeometry(600,600,600),b);b.flipSided=!1;c.add(b);n=new Paddle(c,c.box2dworld);b=n.create(s,w);k.push(n);var f=a(s,-3.2,0.2,1.2256377722587917E7),d=f.body,g=b.GetPosition().Copy();g.Subtract(new Box2D.Common.Math.b2Vec2(0,0));g.Normalize();
g.Multiply(-1);g.x+=0.25*(0.5>Math.random()?-1:1);d.ApplyImpulse(new Box2D.Common.Math.b2Vec2(-0.2,-0.05),d.GetWorldCenter());d.ApplyImpulse(g,d.GetWorldCenter());k.push(f);var d=f=null,g=0,i=levels.getLevel(h);z=[];for(var l=0,A=i.layout.length;l<A;l++){for(var f=i.firstBrickPosition.x,j=0,p=i.layout[l].length;j<p;j++){if(0!=i.layout[l][j]){null===d&&(d=i.firstBrickPosition.y);var B=new Brick(c,c.box2dworld);z.push(B.create(f,d,i.brickSize.x,i.brickSize.y,i.types[i.layout[l][j]]));g+=i.types[i.layout[l][j]].hitCount||
1}f+=i.brickSpace.x}d-=i.brickSpace.y}J=g;f=new b2BodyDef;f.type=b2Body.b2_staticBody;f.position.Set(0,0);f=c.box2dworld.CreateBody(f);f.userData={name:"wall"};d=new b2PolygonShape;g=new b2FixtureDef;g.shape=d;d.SetAsEdge(new b2Vec2(5,5),new b2Vec2(-5,5));f.CreateFixture(g).userData="top";d.SetAsEdge(new b2Vec2(-5,5),new b2Vec2(-5,-5));f.CreateFixture(g).userData="left";d.SetAsEdge(new b2Vec2(-5,-5),new b2Vec2(5,-5));f.CreateFixture(g);d.SetAsEdge(new b2Vec2(5,-5),new b2Vec2(5,5));f.CreateFixture(g).userData=
"right";d=new b2Vec2(1,0);g=new b2PrismaticJointDef;g.Initialize(b,f,b.GetWorldCenter(),d);g.lowerTranslation=-4+s;g.upperTranslation=4+s;g.enableLimit=!0;g.maxMotorForce=1;g.motorSpeed=0;g.enableMotor=!0;c.box2dworld.CreateJoint(g);b=new THREE.PlaneGeometry(10,10);Math.random();f=new THREE.MeshPhongMaterial({color:levels.getLevel(h).planeColor||208966.07738840044,opacity:0.8,transparent:!0});b=new THREE.Mesh(b,f);b.position.set(0,0,-0.2);b.castShadow=!1;b.receiveShadow=!0;c.add(b);ev.pub("game.levelObjectsCreated");
b=new THREE.AmbientLight(1052688);c.add(b);pointLight=new THREE.PointLight(16755200);c.add(pointLight);pointLight.intensity=0.5;pointLight.position.x=1;pointLight.position.y=-8;pointLight.position.z=13;pointLight.intensity=1;pointLight.position.x=-400;b=new THREE.SpotLight(16777215,1,0,Math.PI,1);b.position.set(0,2,5);b.target.position.set(0,0,0);window.lo=pointLight;b.castShadow=!0;b.shadowCameraNear=1;b.shadowCameraFar=10;b.shadowCameraFov=100;c.add(b);K||e();ev.pub("game.start")};this.reset=function(a,
c){K?this.addPreRenderCb(function(){if(0<=m.length)for(var f=m.length-1;0<=f;f--)y.destroyBall(m[f]);c&&(j=!0);b();y.start();a&&a()}):(c&&(j=!0),y.start(),a&&a())};this.cleanup=function(a){this.addPostRenderCb(function(){if(0<=m.length)for(var c=m.length-1;0<=c;c--)y.destroyBall(m[c]);b();n.destroy();a&&a()})};this.togglePause=function(a){this.addPreRenderCb(function(){(j=!j)?a&&a():y.addPostRenderCb(function(){a&&a()})})};this.resetBall=function(a){this.addPreRenderCb(function(){var c=m[0].body;
c.SetLinearVelocity(new Box2D.Common.Math.b2Vec2(0,0));n?c.SetPosition(new Box2D.Common.Math.b2Vec2(n.body.GetPosition().x,-3)):c.SetPosition(new Box2D.Common.Math.b2Vec2(s,-3));var b=n.body.GetPosition().Copy();b.Subtract(new Box2D.Common.Math.b2Vec2(0,0));b.Normalize();b.Multiply(-1);b.x+=0.5*(0.5>Math.random()?-1:1);c.ApplyImpulse(b,c.GetWorldCenter());a&&y.addPostRenderCb(function(){a()});return!0})};this.resetPaddle=function(){s=0;w=-4;n.body.SetPosition(new Box2D.Common.Math.b2Vec2(0,-4))};
this.createBonusBall=function(c,b){var f=a(c,b,0.2,8485631.716873156);f.body.ApplyImpulse(new Box2D.Common.Math.b2Vec2((0.5>Math.random()?-1:1)*Math.random(),(0.5>Math.random()?-1:1)*Math.random()),f.body.GetWorldCenter())};this.destroyBall=function(a){c.remove(a.body.userData.guiref);c.box2dworld.DestroyBody(a.body);m.splice(m.indexOf(a),1);k.splice(k.indexOf(a),1)};this.setBallScale=function(a,c){a&&a.GetFixtureList()&&(a.GetFixtureList().GetShape().SetRadius(a.userData.guiref.geometry.radius*c),
a.userData.guiref.scale.x=c,a.userData.guiref.scale.y=c,a.userData.guiref.scale.z=c,a.userData.guiref.position.z=a.userData.guiref.geometry.radius*c-0.2)};this.setBallSize=function(a,c){this.setBallScale(a,c/a.userData.guiref.geometry.radius)};this.getBallCount=function(){return m.length};this.getBalls=function(){return m};this.destroyBrick=function(a){E.push(a)};this.getBricks=function(){return z};this.getPaddle=function(){return n};this.getCamera=function(){return g};this.setCameraLookAtMesh=function(a){p=
a};this.cameraFollowsPaddle=function(a){x=a};this.setCameraAutoLookAt=function(){};this.setLevel=function(a){h=a};this.getComposer=function(){return l};var A=[],B=[],F=[];this.tweenCamera=function(a,c,b){A.push({type:a,coords:c,cb:b})};this.tweenLookAtCamera=function(a,c,b){B.push({type:a,coords:c,cb:b})};this.tweenCameraLens=function(a,c,b){F.push({type:a,coords:c,cb:b})};this.resetTweenCamera=function(){A=[];B=[];F=[]};var f;moveCameraSchedule=function(){A&&A.length&&(f=A[0],f.coords.yit||(f.coords.yit=
0,null==f.coords.yStart&&(f.coords.yStart=g.position.y),null==f.coords.zStart&&(f.coords.zStart=g.position.z),null==f.coords.xStart&&(f.coords.xStart=g.position.x),null==f.coords.yTarget&&(f.coords.yTarget=g.position.y),null==f.coords.zTarget&&(f.coords.zTarget=g.position.z),null==f.coords.xTarget&&(f.coords.xTarget=g.position.x),null==f.coords.y&&(f.coords.y=0),null==f.coords.z&&(f.coords.z=0),null==f.coords.x&&(f.coords.x=0),null!==f.coords.yTarget&&(f.coords.y=f.coords.yTarget-f.coords.yStart),
null!==f.coords.zTarget&&(f.coords.z=f.coords.zTarget-f.coords.zStart),null!==f.coords.xTarget&&(f.coords.x=f.coords.xTarget-f.coords.xStart),f.coords.speed||(f.coords.speed=50)),g.position.y=f.type(f.coords.yit,f.coords.yStart,f.coords.y,f.coords.speed),g.position.z=f.type(f.coords.yit,f.coords.zStart,f.coords.z,f.coords.speed),g.position.x=f.type(f.coords.yit,f.coords.xStart,f.coords.x,f.coords.speed),f.coords.yit==f.coords.speed&&(A.splice(0,1),f.cb&&f.cb()),f.coords.yit++);B&&B.length&&(f=B[0],
f.coords.yit||(f.coords.yit=0,null==f.coords.yStart&&(f.coords.yStart=0),null==!f.coords.zStart&&(f.coords.zStart=0),null==!f.coords.xStart&&(f.coords.xStart=0),null==f.coords.y&&(f.coords.y=0),null==f.coords.z&&(f.coords.z=0),null==f.coords.x&&(f.coords.x=0),null!==f.coords.yTarget&&(f.coords.y=f.coords.yTarget-f.coords.yStart),null!==f.coords.zTarget&&(f.coords.z=f.coords.zTarget-f.coords.zStart),null!==f.coords.xTarget&&(f.coords.x=f.coords.xTarget-f.coords.xStart),f.coords.speed||(f.coords.speed=
50)),g.lookAt({y:f.type(f.coords.yit,f.coords.yStart,f.coords.y,f.coords.speed),z:f.type(f.coords.yit,f.coords.zStart,f.coords.z,f.coords.speed),x:f.type(f.coords.yit,f.coords.xStart,f.coords.x,f.coords.speed)}),f.coords.yit==f.coords.speed&&(B.splice(0,1),f.cb&&f.cb()),f.coords.yit++);F&&F.length&&(f=F[0],f.coords.yit||(f.coords.yit=0,null==f.coords.start&&(f.coords.start=0),null==f.coords.target&&(f.coords.target=0),null==f.coords.change&&(f.coords.change=f.coords.target-f.coords.start),f.coords.speed||
(f.coords.speed=50)),g.setLens(f.type(f.coords.yit,f.coords.start,f.coords.change,f.coords.speed)),f.coords.yit==f.coords.speed&&(F.splice(0,1),f.cb&&f.cb()),f.coords.yit++)};this.getScene=function(){return c};var H,I,q,r,v,L=function(a){H=a.GetFixtureA();I=a.GetFixtureB();q=H.GetBody();r=I.GetBody();brick=v=null;q.userData&&"ball"==q.userData.name&&r.userData&&"brick"==r.userData.name?(v=q,brick=r):r.userData&&("ball"==r.userData.name&&q.userData&&"brick"==q.userData.name)&&(v=r,brick=q);v&&brick&&
ev.pub("game.brickPreHit",{contact:a,bricksLeft:J,brick:brick,ball:v})},E=[],C=[];this.addPreRenderCb=function(a){C.push(a)};var D=[];this.addPostRenderCb=function(a){D.push(a)};var u,G,K=!1};bricks3d.resources={};
Resources=function(){var a={},b=new THREE.JSONLoader,d="music/JAHOOR.ogg;music/game over.ogg;music/leveleen.ogg;music/leveldrie.ogg;music/level hakken.ogg;music/GEFORCE.ogg;music/DJCLANTM.ogg;music/russia.mp3;music/hit2.ogg;music/hit.ogg;music/bonus1.ogg;music/bonus2.ogg;music/bonus3.ogg;music/alarm.ogg;music/blow.ogg".split(";"),e=["models/paddle.js"],h=[{name:"textures/bg1.png",maps:"textures/bg1.png textures/bg1.png textures/bg1.png textures/bg1.png textures/bg1.png textures/bg1.png".split(" ")},{name:"textures/bg2.png",
maps:"textures/bg2.png textures/bg2.png textures/bg2.png textures/bg2.png textures/bg2.png textures/bg2.png".split(" ")},{name:"textures/bg3.png",maps:"textures/bg3.png textures/bg3.png textures/bg3.png textures/bg3.png textures/bg3.png textures/bg3.png".split(" ")},{name:"textures/bg4.png",maps:"textures/bg4.png textures/bg4.png textures/bg4.png textures/bg4.png textures/bg4.png textures/bg4.png".split(" ")},{name:"textures/bg5.png",maps:"textures/bg5.png textures/bg5.png textures/bg5.png textures/bg5.png textures/bg5.png textures/bg5.png".split(" ")}],
g=d.length+e.length+h.length,c=function(c,b){if(!window.AudioContext||!window.webkitAudioContext)b();else{var d=new XMLHttpRequest;d.open("GET",c,!0);d.responseType="arraybuffer";d.onload=function(){audioContext.decodeAudioData(d.response,function(d){a[c]=d;b()},void 0)};d.addEventListener("progress",function(a){j(c,a.loaded/a.total)},!1);d.send()}},i=function(c,d){b.load(c,function(b,e){j(c,1);a[c]={geometry:b,materials:e};d()})},l=function(c,b,d){var e=THREE.ImageUtils.loadTextureCube(b,null,function(){j(c,
1);a[c]=e;d()})},k=[],j=function(a,c){k[a]=c;var b=0,d;for(d in k)b+=k[d];document.getElementById("loadingText").innerHTML="Loading "+Math.round(100*(b/g))+"%";b==g&&(document.getElementById("loadingText").innerHTML="Please wait....")};this.getResource=function(c){return a[c]};this.loadResources=function(a){for(var b=0,j=function(){b++;b==g&&(document.getElementById("loadingContainer").style.display="none",a())},k=0;k<d.length;k++)c(d[k],function(){j()});for(k=0;k<e.length;k++)i(e[k],function(){j()});
for(k=0;k<h.length;k++)l(h[k].name,h[k].maps,function(){j()})}};bricks3d.sound={};
var Sound=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext;if(AudioContext){var a=new AudioContext;window.audioContext=a}var b,d={};this.playSound=function(a){if(!d[a]){var e=resource.getResource(a);e&&(b=audioContext.createBufferSource(),b.buffer=e,b.connect(audioContext.destination),b.start(0),d[a]=!0,setTimeout(function(){delete d[a]},20))}};var e={};this.playTheme=function(){if(a){e.theme&&e.theme.stop(0);h&&h.stop(0);var c=resource.getResource("music/JAHOOR.ogg");c&&
(b=audioContext.createBufferSource(),b.buffer=c,b.connect(audioContext.destination),b.loop=!0,e.theme=b,b.start(0))}};var h;this.playCredits=function(){if(a){e.theme&&e.theme.stop(0);h&&h.stop(0);var c=resource.getResource("music/JAHOOR.ogg");c&&(b=audioContext.createBufferSource(),b.buffer=c,b.connect(audioContext.destination),b.loop=!0,b.start(0),h=b)}};var g;this.playGameOver=function(){if(a){e.theme&&e.theme.stop(0);h&&h.stop(0);var c=resource.getResource("music/game over.ogg");c&&(b=audioContext.createBufferSource(),
b.buffer=c,b.connect(audioContext.destination),b.loop=!0,b.start(0),g=b)}};this.stopLevelMusic=function(c){a&&e[c]&&e[c].stop(0)};this.playLevelMusic=function(c){if(a){e[c]&&e[c].stop(0);h&&h.stop(0);g&&g.stop(0);e[c-1]&&e[c-1].stop(0);e.theme&&e.theme.stop(0);var d=resource.getResource(levels.getLevel(c).music);d&&(b=audioContext.createBufferSource(),b.buffer=d,b.connect(audioContext.destination),b.loop=!0,e[c]=b,b.start(0))}}};bricks3d.tween={};
var Tween={easeInQuad:function(a,b,d,e){return d*(a/=e)*a+b},linear:function(a,b,d,e){return a/e*d+b},easeOutQuad:function(a,b,d,e){return-d*(a/=e)*(a-2)+b},easeInOutQuad:function(a,b,d,e){return 1>(a/=e/2)?d/2*a*a+b:-d/2*(--a*(a-2)-1)+b},sineInOut:function(a,b,d,e){return-d/2*(Math.cos(Math.PI*a/e)-1)+b},quintInOut:function(a,b,d,e){a/=e/2;if(1>a)return d/2*a*a*a*a*a+b;a-=2;return d/2*(a*a*a*a*a+2)+b},circInOut:function(a,b,d,e){a/=e/2;if(1>a)return-d/2*(Math.sqrt(1-a*a)-1)+b;a-=2;return d/2*(Math.sqrt(1-
a*a)+1)+b}};bricks3d.util={};ev={};
ev={subs:[],subsIndex:[],published:{},sub:function(a,b){var d=ev.subsIndex.indexOf(a);-1==d&&(ev.subsIndex.push(a),ev.subs.push([]),d=ev.subsIndex.length-1);ev.subs[d].push({to:a,cb:b})},pub:function(a,b){var d,e=ev.subsIndex.indexOf(a);ev.published[a]=b||!0;if(-1==e)return null;d=0;for(len=ev.subs[e].length;d<len;d++)ev.subs[e][d].cb(b)},unsub:function(a){var b=ev.subsIndex.indexOf(a);ev.subsIndex.indexOf(a);-1!=b&&(ev.subs[b]=[],ev.subsIndex[a]=[])},executeAfter:function(a,b){ev.published[a]?b(ev.published[a]):
ev.sub(a,b)}};
Color=function(a,b,d){var e;this.getR=function(){return this.r};this.setR=function(a){this.r=a;this.computeHSV()};this.getG=function(){return this.g};this.setG=function(a){this.g=a;this.computeHSV()};this.getB=function(){return this.b};this.setB=function(a){this.b=a;this.computeHSV()};this.getH=function(){return this.h};this.setH=function(a){this.h=a;this.computeRGB()};this.getS=function(){return this.s};this.setS=function(a){this.s=a;this.computeRGB()};this.getV=function(){return this.v};this.setV=
function(a){this.v=a;this.computeRGB()};var h=function(a){return parseInt(a,16)};this.setValue=function(a){"#"===a.substr(0,1)?(this.r=h(a.substr(1,2)),this.g=h(a.substr(3,2)),this.b=h(a.substr(5,2))):(a=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.exec(a),this.r=parseInt(a[1]),this.g=parseInt(a[2]),this.b=parseInt(a[3]));this.computeHSV()};this.getValue=function(){return"#"+((16>this.r?"0":"")+this.r.toString(16))+((16>this.g?"0":"")+this.g.toString(16))+((16>this.b?"0":"")+this.b.toString(16))};
this.computeHSV=function(){var a=this.r/255,c=this.g/255,b=this.b/255,d=Math.min(a,c,b),e=Math.max(a,c,b),d=e-d,h=0,n=0;0!=e?(n=d/e,h=60*(d?a==e?(c-b)/d:c==e?2+(b-a)/d:4+(a-c)/d:0),0>h&&(h+=360)):(n=0,h=-1);this.h=h;this.s=n;this.v=e};this.computeRGB=function(){var a=this.h,c=this.s,b=this.v,d=0,h=0,j=0,n=0,d=h=0;if(0==c)e=d=j=b;else switch(a=a%360/60,d=Math.floor(a),h=a-d,j=b*(1-c),n=b*(1-c*h),h=b*(1-c*(1-h)),d){case 0:e=b;d=h;break;case 1:e=n;d=b;break;case 2:e=j;d=b;j=h;break;case 3:e=j;d=n;j=
b;break;case 4:e=h;d=j;j=b;break;default:e=b,d=j,j=n}this.r=Math.round(255*e);this.g=Math.round(255*d);this.b=Math.round(255*j)};"string"==typeof a?this.setValue(a):("number"==typeof a?(this.r=a,this.g=b,this.b=d):this.b=this.g=this.r=0,this.computeHSV())};
(function(){for(var a=0,b=["ms","moz","webkit","o"],d=0;d<b.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[b[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[d]+"CancelAnimationFrame"]||window[b[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var d=(new Date).getTime(),g=Math.max(0,16-(d-a)),c=window.setTimeout(function(){b(d+g)},g);a=d+g;return c});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();bricks3d.levels={};
levels=function(){var a=[];a.push({type:"align",background:"textures/bg1.png",gameSize:{x:5,y:5},music:"music/leveleen.ogg",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.47,y:0.22,z:0.22},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},5:{color:1.53461601086433E7,type:"superspeed"},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},6:{color:1.93461601086433E7,type:"ghost"},7:{color:934446.7959924,type:"normal",
hitCount:3,onHitTransformTo:4},9:{color:4234.234342,type:"bigBall"}},layout:[[1,9,1,2,1,9,1],[1,1,1,1,1,1,1],[7,1,4,2,4,1,7],[5,5,1,1,1,5,5],[1,1,1,7,1,1,1],[1,1,1,1,1,1,1],[0,1,1,2,1,1,0],[0,0,1,1,1,0,0]]});Math.random();a.push({type:"align",background:"textures/bg2.png",planeColor:208966.07738840044,gameSize:{x:5,y:5},music:"music/leveleen.ogg",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.47,y:0.22,z:0.22},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,
type:"extraBalls"},5:{color:1.53461601086433E7,type:"superspeed"},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},6:{color:1.93461601086433E7,type:"ghost"},7:{color:934446.795992431,type:"normal",hitCount:3,onHitTransformTo:4},8:{color:1860824.026639538,type:"normal"},9:{color:4234.234342,type:"bigBall"}},layout:[[0,1,1,2,1,1,0],[0,1,8,5,8,1,0],[0,1,1,1,1,1,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]]});a.push({type:"align",gameSize:{x:5,
y:5},background:"textures/bg4.png",planeColor:26112,music:"music/russia.mp3",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.47,y:0.22,z:0.22},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},5:{color:1.53461601086433E7,type:"superspeed"},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},6:{color:1.93461601086433E7,type:"ghost"}},layout:[[1,5,1,5,1,5,1],[1,1,1,2,1,1,1],[1,1,2,6,2,1,1],[1,1,1,1,1,1,1],[0,0,
1,1,1,0,0],[0,0,4,4,4,0,0],[0,0,1,1,1,0,0]]});a.push({type:"align",background:"textures/bg3.png",planeColor:9043968,gameSize:{x:5,y:5},music:"music/leveldrie.ogg",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.47,y:0.22,z:0.22},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},3:{color:8485631.716873156,type:"normal",hitCount:3,onHitTransformTo:4},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},5:{color:1.1808294026639538E7,
type:"normal"},6:{color:1.53461601086433E7,type:"superspeed"},7:{color:934446.795992431,type:"normal",hitCount:3,onHitTransformTo:4},9:{color:4234.234342,type:"bigBall"}},layout:[[9,6,6,1,6,6,9],[1,6,6,1,6,6,1],[1,6,6,1,6,6,1],[2,3,2,2,2,3,2],[7,7,7,7,7,7,7],[4,4,4,4,4,4,4],[5,5,5,5,5,5,5]]});a.push({type:"align",gameSize:{x:5,y:5},background:"textures/bg5.png",music:"music/DJCLANTM.ogg",planeColor:7997750,firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.47,y:0.22,z:0.22},brickSpace:{x:1,y:0.52},types:{1:{color:1.1808294026639538E7,
type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},3:{color:8157503.589997533,type:"normal"},4:{color:1274646.795992431,type:"normal"},5:{color:6.1838294026639536E7,type:"normal"}},layout:[[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[2,0,2,0,2,0,2],[3,0,3,0,3,0,3],[4,0,4,0,4,0,4],[5,0,5,0,5,0,5]]});a.push({type:"align",gameSize:{x:5,y:5},music:"music/GEFORCE.ogg",firstBrickPosition:{x:-3,y:2.4},brickSize:{x:0.24,y:0.12,z:0.12},brickSpace:{x:0.5,y:0.27},types:{1:{color:1.1808294026639538E7,
type:"normal"},2:{color:6356160.3086433,type:"extraBalls"},5:{color:1.53461601086433E7,type:"superspeed"},4:{color:4274646.795992431,type:"normal",hitCount:2,onHitTransformTo:1},6:{color:1.93461601086433E7,type:"ghost"},7:{color:934446.795992431,type:"normal",hitCount:3,onHitTransformTo:4},9:{color:4234.234342,type:"bigBall"},8:{color:1860824.026639538,type:"normal"}},layout:[[7,7,7,7,7,7,2,2,7,7,7,7,7,7],[1,1,1,1,1,1,2,2,1,1,1,1,1,0],[0,0,1,1,1,1,4,4,1,1,1,1,0,0],[0,0,0,1,1,1,2,2,1,2,1,0,0,0],[0,
0,0,0,9,1,4,4,1,9,0,0,0,0],[0,0,0,0,0,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,6,6,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,0,0,0,0,0],[0,0,0,0,9,1,2,2,1,9,0,0,0,0],[0,0,0,1,1,1,2,2,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,1,0,0],[0,7,7,7,7,7,7,7,7,7,7,7,7,0]]});return{getLevel:function(b){return a[b]}}}();bricks3d.gameobject={};function GameObject(){this.body=null;this.sync=function(){this.body.userData.guiref.position.x=this.body.GetPosition().x;this.body.userData.guiref.position.y=this.body.GetPosition().y};this.validate=function(){};this.destroy=function(){}};bricks3d.ball={};
function Ball(a,b){this.maxSpeed=5;this.create=function(d,h,g,c){var i=new THREE.SphereGeometry(g,32,8);i.dynamic=!0;c=c||16777215*Math.random();material=new THREE.MeshPhongMaterial({color:c,shininess:100});c=new THREE.Mesh(i,material);c.castShadow=!0;this.mesh=c;a.add(c);i=new b2BodyDef;i.type=b2Body.b2_dynamicBody;i.position.x=d;i.position.y=h;d=b.CreateBody(i);d.userData={name:"ball",guiref:c};h=new b2FixtureDef;h.density=1;h.friction=0;h.restitution=1;h.shape=new b2CircleShape(g);d.CreateFixture(h);
return this.body=d};this.maintainSpeed=function(){var a=this.body,b=a.GetLinearVelocity().Length(),d=this.maxSpeed;b>d?a.SetLinearDamping(0.9):b<=d&&a.SetLinearDamping(0);b<d&&(b=a.GetLinearVelocity(),b.Set(1.05*b.x,1.05*b.y),a.ApplyForce(b,a.GetWorldCenter()),a.SetLinearDamping(0))};this.sync=function(){this.body.userData.guiref.position.x=this.body.GetPosition().x;this.body.userData.guiref.position.y=this.body.GetPosition().y;this.maintainSpeed()};var d=!1;this.validate=function(){-4.5<this.body.GetPosition().y&&
(d=!1);!d&&-4.5>this.body.GetPosition().y&&(d=!0,ev.pub("game.ball.dies",this))}}Ball.prototype=new GameObject;Ball.prototype.constructor=GameObject;bricks3d.paddle={};
function Paddle(a,b){var d=0.01;this.mesh=null;var e=!1,h=!1,g=function(a){if(37==a.keyCode||65==a.keyCode)h=!0;else if(39==a.keyCode||68==a.keyCode)e=!0},c=function(a){if(37==a.keyCode||65==a.keyCode)h=!1;else if(39==a.keyCode||68==a.keyCode)e=!1},i;this.updateControls=function(){var a=0;e&&++a;h&&--a;i=a;0<i?(this.body.ApplyImpulse(new Box2D.Common.Math.b2Vec2(2.7,0),this.body.GetWorldCenter()),d+=i/100,0>d&&(d+=i/60)):0>i&&(this.body.ApplyImpulse(new Box2D.Common.Math.b2Vec2(-2.7,0),this.body.GetWorldCenter()),
d+=i/100,0<d&&(d+=i/60))};this.create=function(d,e){var h=resource.getResource("models/paddle.js");mesh=new THREE.Mesh(h.geometry,new THREE.MeshFaceMaterial(h.materials));mesh.scale.set(1,1,1);mesh.rotation.x=1.5;mesh.position.x=d;mesh.position.y=e;a.add(mesh);this.mesh=mesh;h=new b2FixtureDef;h.density=11;h.friction=50;h.linearDamping=1005;h.restitution=0;var i=new b2BodyDef;i.type=b2Body.b2_dynamicBody;bodyPoly=new b2PolygonShape;h.shape=bodyPoly;var m=[];m.push(new b2Vec2(0.8,0.2));m.push(new b2Vec2(0.7,
0.33));m.push(new b2Vec2(0.2,0.35));m.push(new b2Vec2(-0.2,0.35));m.push(new b2Vec2(-0.7,0.33));m.push(new b2Vec2(-0.8,0.2));bodyPoly.SetAsArray(m,m.length);i.position.x=d;i.position.y=e;i=b.CreateBody(i);i.CreateFixture(h);i.SetLinearDamping(5.9);this.body=i;this.body.userData={name:"paddle",guiref:this.mesh};document.addEventListener("keydown",g);document.addEventListener("keyup",c);return this.body};this.sync=function(){this.body.userData.guiref.position.x=this.body.GetPosition().x;this.body.userData.guiref.position.y=
this.body.GetPosition().y};this.destroy=function(){document.removeEventListener("keydown",g);document.removeEventListener("keyup",c)}}Paddle.prototype=new GameObject;Paddle.prototype.constructor=GameObject;bricks3d.brick={};
function Brick(a,b){this.create=function(d,e,h,g,c){var i=new THREE.MeshPhongMaterial({color:c.color,shininess:50,opacity:1,transparent:!0}),l=new THREE.CubeGeometry(2*h,2*g,0.5),i=new THREE.Mesh(l,i);i.position.z=0;i.position.x=d;i.position.y=e;i.receiveShadow=!1;i.castShadow=!0;i.matrixAutoUpdate=!0;a.add(i);a.add(i);l=new b2FixtureDef;l.density=11;l.restitution=0;var k=new b2BodyDef;k.type=b2Body.b2_staticBody;l.shape=new b2PolygonShape;l.shape.SetAsBox(h,g);k.position.x=d;k.position.y=e;d=b.CreateBody(k);
d.CreateFixture(l);d.SetLinearDamping(5.9);d.userData={name:"brick",guiref:i,type:c,hitCount:c.hitCount||1};return d};this.sync=function(){this.body.userData.guiref.position.x=this.body.GetPosition().x;this.body.userData.guiref.position.y=this.body.GetPosition().y}}Brick.prototype=new GameObject;Brick.prototype.constructor=GameObject;var resource=new Resources,game=function(){function a(){function a(){j.currentState!=k.gameover&&j.currentState!=k.demo||(b.style.opacity=Tween.easeInOutQuad(h,c,d,e),h++,h%=2*e,setTimeout(function(){a()},20))}var b=document.getElementById("startTitle"),c=1,d=-1,e=20,h=0;a();var g=function(a){13==a.keyCode&&(j.startGame(),document.removeEventListener("keyup",g,!1))};document.addEventListener("keyup",g)}function b(){ev.unsub("game.paddleHit");ev.unsub("game.brickPreHit");ev.unsub("game.brickHit");
ev.unsub("game.ball.dies");ev.unsub("game.ball.created");ev.unsub("game.start");ev.unsub("game.levelObjectsCreated");ev.unsub("game.wallCollition")}if(!Detector.webgl)return document.getElementById("loadingContainer").innerHTML="",document.getElementById("loadingContainer").appendChild(Detector.getWebGLErrorMessage());var d=1,e=4,h=0,g=1,c=new BrickGame,i=new Hud,l=new Sound,k={demo:1,playing:2,gameover:3,credits:4},j={currentState:null,startDemo:function(){j.currentState=k.demo;l.playTheme();document.getElementById("splashContainer").style.display=
"block";document.getElementById("startTitle").style.opacity=0;var b=function(){a()},i=function(){x!=p&&c.addPreRenderCb(function(){c.getComposer().passes[2].copyUniforms.opacity.value=Tween.easeInOutQuad(x,1.4,-0.4,p);x++;i()})};demo=!0;d=0;e=4;h=0;ev.sub("game.ball.dies",function(a){1==c.getBallCount()&&!e?(h=d=0,g=1,c.setLevel(d),c.reset(function(){s(function(){c.togglePause()})},!0),e=4):1==c.getBallCount()?(e--,g=1,c.resetBall()):c.addPreRenderCb(function(){c.destroyBall(a)})});ev.sub("game.brickHit",
function(a){var b=100*g;h+=b;g+=1;if("extraBalls"==a.brick.userData.type.type)c.addPreRenderCb(function(){c.createBonusBall(3,3);c.createBonusBall(-3,3)});else if("bigBall"==a.brick.userData.type.type)!0!=a.ball.userData.isBigBall&&(a.ball.userData.isBigBall=!0,m(a.ball,0.2,0.2,function(){setTimeout(function(){m(a.ball,0.4,-0.2,function(){a.ball.userData.isBigBall=!1})},5E3)}));else if("superspeed"==a.brick.userData.type.type){var e=a.ball.GetLinearVelocity(),f=2*e.x,e=2*e.y,f=0>f?Math.max(f,-15):
Math.min(f,15),e=0>e?Math.max(e,-15):Math.min(e,15);a.ball.SetLinearVelocity(new b2Vec2(f,e))}brick.userData.hitCount?z({brick:a.brick,score:b,enableBrickFadeOut:!1},function(){}):z({brick:a.brick,score:b,enableBrickFadeOut:!0},function(a){c.destroyBrick(a)});a.bricksLeft||(c.setLevel(d),c.togglePause(function(){c.reset(function(){s(function(){c.togglePause()})},!0)}))});ev.sub("game.brickPreHit",function(a){"ghost"==a.brick.userData.type.type&&(a.contact.SetEnabled(!1),a.ball.userData.isGhost=!0,
a.ball.userData.guiref.material.opacity=0.5,setTimeout(function(){a.ball.userData.guiref.material.opacity=1;a.contact.SetEnabled(!0);a.ball.userData.isGhost=!1},5E3));a.ball.userData.isGhost&&a.contact.SetEnabled(!1)});ev.sub("game.paddleHit",function(){g=1});var p=100,x=0;i();c.setLevel(d);c.start();c.setCameraLookAtMesh({position:{x:0,y:-2,z:0}});c.tweenCameraLens(Tween.easeInOutQuad,{start:10,target:25,speed:200});c.tweenCamera(Tween.easeOutQuad,{yStart:-7,yTarget:-6,zStart:4,zTarget:2,xTarget:4,
speed:200},function(){function a(){c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-6,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:-5,zTarget:3,xTarget:-5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-5,speed:1500},function(){a()})}c.tweenCameraLens(Tween.easeInOutQuad,{start:25,target:19,speed:300});a()});n(1,-1,function(){});c.cameraFollowsPaddle(!1);c.reset(function(){for(var d=
function(){if(j.currentState==k.demo){for(var a=0,b=e.length;a<b;a++)e[a].position.z+=e[a].position.speedz,e[a].position.x+=e[a].position.speedx,e[a].position.y+=e[a].position.speedy,50<e[a].position.z&&(e[a].position.z=-50,e[a].position.z=-50);c.addPreRenderCb(function(){d()})}},e=[],h=[1.581393358085355E7,6100182.730150754,4326982.82802921,1467844.0140721737,2028035.0978696812,1.1345698050306158E7],f=0;50>f;f++){var g=new THREE.SphereGeometry(5,32,32);g.dynamic=!1;material=new THREE.MeshPhongMaterial({color:h[Math.floor(Math.random()*
h.length)],shininess:66,opacity:0.3,transparent:!0});g=new THREE.Mesh(g,material);g.useQuaternion=!0;g.receiveShadow=!0;g.castShadow=!0;g.position.y=100*Math.random()*(0.5>Math.random()?-1:1);g.position.x=100*Math.random()*(0.5>Math.random()?-1:1);g.position.z=100*Math.random()*(0.5>Math.random()?-1:1);g.position.speedz=0.3*Math.random();g.position.speedx=0.1*Math.random()*(0.5>Math.random()?-1:1);g.position.speedy=0.1*Math.random()*(0.5>Math.random()?-1:1);e.push(g);c.getScene().add(g)}c.addPreRenderCb(function(){d()});
c.togglePause(function(){s(function(){c.togglePause();var d=function(){if(w){var a=0,b=0;if(c.getBalls().length){for(var f=c.getBalls(),e,g=0;g<f.length;g++)e||(e=f[g]),e.body.GetPosition().y>f[g].body.GetPosition().y&&(e=f[g]);f=e.body.GetPosition().x-c.getPaddle().body.GetPosition().x;0.4<f?(a++,b=0,c.getPaddle().body.ApplyImpulse(new Box2D.Common.Math.b2Vec2(6.2,0),c.getPaddle().body.GetWorldCenter())):-0.4>f&&(b++,a=0,c.getPaddle().body.ApplyImpulse(new Box2D.Common.Math.b2Vec2(-6.2,0),c.getPaddle().body.GetWorldCenter()))}setTimeout(function(){w&&
d()},20)}};w=!0;d();b&&a()})})})},startGameover:function(){l.stopLevelMusic(d);l.playGameOver();j.clearPreviousState(function(){j.currentState=k.gameover;c.togglePause();n(0,1,function(){function b(){e==d?a():c.addPreRenderCb(function(){c.getComposer().passes[2].copyUniforms.opacity.value=Tween.easeInOutQuad(e,2,-0.5,d);e++;b()})}c.resetPaddle();var d=100,e=0;b();document.getElementById("gameoverTitle").style.display="block";i.clear();c.setCameraLookAtMesh({position:{x:0,y:-2,z:0}});c.cameraFollowsPaddle(!1);
c.tweenCamera(Tween.easeOutQuad,{yTarget:-6,zTarget:2,xTarget:-4,speed:200},function(){function a(){c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:6,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:-5,zTarget:3,xTarget:-5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-5,speed:1500},function(){a()})}c.tweenCameraLens(Tween.easeInOutQuad,{start:25,target:19,speed:300});
a()});n(1,-1,function(){})})})},startGame:function(){j.clearPreviousState(function(){j.currentState=k.playing;document.getElementById("gameoverTitle").style.display="none";document.getElementById("startTitle").style.opacity=0;d=1;e=4;h=0;ev.sub("game.start",function(){i.drawGameStatistics(h,d,e)});ev.sub("game.levelObjectsCreated",function(){c.resetPaddle();l.playLevelMusic(d);c.tweenCamera(Tween.easeInOutQuad,{yTarget:-7,zTarget:6})});ev.sub("game.wallCollition",function(){l.playSound("music/hit2.ogg")});
ev.sub("game.ball.created",function(){2==c.getBallCount()&&c.tweenCamera(Tween.easeInOutQuad,{yTarget:-7,zTarget:8})});ev.sub("game.ball.dies",function(a){if(1==c.getBallCount()&&!e)return j.startGameover();1==c.getBallCount()?(e--,g=1,i.drawGameStatistics(h,d,e),c.resetBall(function(){c.togglePause(function(){setTimeout(function(){c.togglePause()},1E3)})})):c.addPreRenderCb(function(){c.destroyBall(a);1==c.getBallCount()&&c.tweenCamera(Tween.easeInOutQuad,{yTarget:-7,zTarget:6})})});ev.sub("game.brickHit",
function(a){var b=100*g;h+=b;i.drawGameStatistics(h,d,e);g+=1;if("extraBalls"==a.brick.userData.type.type)l.playSound("music/bonus1.ogg"),c.addPreRenderCb(function(){c.createBonusBall(3,3);c.createBonusBall(-3,3)});else if("bigBall"==a.brick.userData.type.type)!0!=a.ball.userData.isBigBall&&(l.playSound("music/blow.ogg"),a.ball.userData.isBigBall=!0,m(a.ball,0.2,0.2,function(){setTimeout(function(){m(a.ball,0.4,-0.2,function(){a.ball.userData.isBigBall=!1})},5E3)}));else if("superspeed"==a.brick.userData.type.type){l.playSound("music/alarm.ogg");
var p=a.ball.GetLinearVelocity(),k=2*p.x,p=2*p.y,k=0>k?Math.max(k,-15):Math.min(k,15),p=0>p?Math.max(p,-15):Math.min(p,15);a.ball.SetLinearVelocity(new b2Vec2(k,p))}else"ghost"==a.brick.userData.type.type?l.playSound("music/bonus3.ogg"):l.playSound("music/hit.ogg");brick.userData.hitCount?z({brick:a.brick,score:b,enableBrickFadeOut:!1},function(){}):z({brick:a.brick,score:b,enableBrickFadeOut:!0},function(a){c.destroyBrick(a)});if(!a.bricksLeft){d++;if(!levels.getLevel(d))return l.stopLevelMusic(d-
1),j.startCredits();c.setLevel(d);c.togglePause(function(){c.setCameraLookAtMesh(null);c.cameraFollowsPaddle(!1);var b=a.brick,g=function(){c.togglePause(function(){c.reset(function(){c.resetPaddle();c.resetBall();c.setCameraLookAtMesh(c.getPaddle().mesh);c.cameraFollowsPaddle(!0);s(function(){i.drawGameStatistics(h,d,e);c.togglePause()})},!0)})},p=function(){n(0,1,function(){n(1,-1,function(){})})},f=c.getPaddle().mesh.position.x,j=c.getPaddle().mesh.position.z,k=c.getPaddle().mesh.position.y,l=
b.GetPosition().x;b.GetPosition();var m=b.GetPosition().y;c.getCamera();var x=c.getCamera().position.y,y=c.getCamera().position.z;c.tweenCamera(Tween.easeInOutQuad,{yStart:x,yTarget:m-1,zStart:y,zTarget:2,xStart:f/1.3,xTarget:l,speed:20});c.tweenLookAtCamera(Tween.easeInOutQuad,{yStart:k+2,yTarget:m,zStart:j,zTarget:j,xStart:f,xTarget:l,speed:20},function(){c.tweenCamera(Tween.linear,{yStart:m-1,yTarget:m-1,zStart:2,zTarget:2,xStart:l,xTarget:l,speed:60},function(){p&&p();c.tweenCamera(Tween.easeInOutQuad,
{yStart:m-1,yTarget:x,zStart:2,zTarget:y,xStart:l,xTarget:0,speed:20});c.tweenLookAtCamera(Tween.easeInOutQuad,{yStart:m,yTarget:k+2,zStart:j,zTarget:j,xStart:l,xTarget:0,speed:20},function(){g&&g()})})})})}});ev.sub("game.brickPreHit",function(a){"ghost"==a.brick.userData.type.type&&(a.contact.SetEnabled(!1),a.ball.userData.isGhost=!0,a.ball.userData.guiref.material.opacity=0.5,setTimeout(function(){a.ball.userData.guiref.material.opacity=1;a.contact.SetEnabled(!0);a.ball.userData.isGhost=!1},5E3));
a.ball.userData.isGhost&&a.contact.SetEnabled(!1)});ev.sub("game.paddleHit",function(){g=1});c.setLevel(d);n(0,1,function(){c.reset(function(){c.setCameraLookAtMesh(c.getPaddle().mesh);c.cameraFollowsPaddle(!0);c.togglePause(function(){c.getCamera().setLens(25);c.getCamera().position.x=0;c.getCamera().position.y=-7;c.getCamera().position.z=2;s(function(){i.drawGameStatistics(h,d,e);c.togglePause()});n(1,-1,function(){});c.getComposer().passes[2].copyUniforms.opacity.value=0.7;c.tweenCamera(Tween.easeInOutQuad,
{yTarget:-7,zTarget:6,xTarget:0})})})})})},startCredits:function(){j.currentState=k.credits;var a=function(){p!=g&&c.addPreRenderCb(function(){c.getComposer().passes[2].copyUniforms.opacity.value=Tween.easeInOutQuad(p,1.4,-0.4,g);p++;a()})};document.getElementById("gameoverTitle").style.display="none";document.getElementById("startTitle").style.opacity=0;document.getElementById("splashContainer").style.display="none";l.playCredits();demo=!0;d=1;e=4;h=0;b();i.showCredits();setTimeout(function(){i.stopCredits();
j.startDemo()},3E4);document.getElementById("credits").style.display="block";var g=100,p=0;a();c.tweenCameraLens(Tween.easeInOutQuad,{start:10,target:25,speed:200});c.tweenCamera(Tween.easeOutQuad,{yStart:-7,yTarget:-6,zStart:4,zTarget:2,xTarget:4,speed:200},function(){function a(){c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:5,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-6,speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:-5,zTarget:3,xTarget:-5,
speed:1500});c.tweenCamera(Tween.easeInOutQuad,{yTarget:5,zTarget:3,xTarget:-5,speed:1500},function(){a()})}c.tweenCameraLens(Tween.easeInOutQuad,{start:25,target:19,speed:300});a()});n(1,-1,function(){});c.cameraFollowsPaddle(!1)},clearPreviousState:function(a){j.currentState==k.demo?j.currentState!=k.demo?a():(document.getElementById("splashContainer").style.display="none",demo=w=demo=!1,c.resetTweenCamera(),b(),c.resetPaddle(),c.cleanup(a)):j.currentState==k.playing?a():j.currentState==k.gameover?
(document.getElementById("gameoverTitle").style.display="none",document.getElementById("startTitle").style.opacity=0,w=!1,c.resetTweenCamera(),b(),c.cleanup(a),c.togglePause()):a()}};resource.loadResources(function(){c.setLevel(d);c.init();j.startDemo()});var n=function(a,b,c){function d(){h==g?c&&c():(e.style.opacity=Tween.easeInOutQuad(h,a,b,g),h++,h%=2*g,setTimeout(function(){d()},20))}var e=document.getElementById("white"),g=20,h=0;d()},m=function(a,b,d,e){function g(a){c.addPreRenderCb(function(){c.setBallSize(a,
Tween.sineInOut(h,b,d,i));h++;i==h?e&&e():g(a)})}var h=0,i=100;g(a)},z=function(a,b){var e=a.brick,g=new THREE.TextGeometry(a.score,{size:0.3,height:0.05,curveSegments:4,font:"helvetiker",weight:"bold",style:"normal",material:0,extrudeMaterial:1});g.computeBoundingBox();g.computeVertexNormals();var h=new THREE.MeshFaceMaterial([new THREE.MeshPhongMaterial({color:16777215,shading:THREE.SmoothShading,transparent:!0,opacity:0.8}),new THREE.MeshPhongMaterial({color:16777215,shading:THREE.SmoothShading,
transparent:!0,opacity:0.8})]);textMesh1=new THREE.Mesh(g,h);textMesh1.position.x=e.GetPosition().x-0.3;textMesh1.position.y=e.GetPosition().y;textMesh1.position.z=0.5;textMesh1.rotation.x=1.7;parent=new THREE.Object3D;parent.castShadow=!0;parent.receiveShadow=!1;if(c.getScene()){c.getScene().add(parent);parent.add(textMesh1);e.userData.hitCount?(e.userData.type=levels.getLevel(d).types[e.userData.type.onHitTransformTo],e.userData.guiref.material.color.set(e.userData.type.color)):c.addPreRenderCb(function(){e.SetActive(!1);
e.userData.guiref.castShadow=!1;e.userData.guiref.material.color.setHex("0xffffff")});var i=textMesh1,j=parent,f=function(){c.addPreRenderCb(function(){var d=Tween.easeInQuad(l,1,-1,30);i.material.materials[0].opacity=d;i.material.materials[1].opacity=d;i.scale.x+=k;i.scale.y+=k;a.enableBrickFadeOut&&(e.userData.guiref.material.opacity=d);c.addPostRenderCb(function(){30==l?(c.getScene().remove(j),b(e)):f();l++})})},k=0.02,l=0;f()}},s=function(a){function b(){c.addPreRenderCb(function(){for(var f=
!0,g=0,h=d.length;g<h;g++)d[g].userData.guiref.material.opacity=1,d[g].userData.guiref.position.z-=e,0>d[g].userData.guiref.position.z?d[g].userData.guiref.position.z=0:f=!1;c.addPostRenderCb(function(){f?a():b()})})}for(var d=c.getBricks(),e=0.3,g=1,h=0,i=d.length;h<i;h++)d[h].userData.guiref.position.z=4+g,d[h].userData.guiref.material.opacity=0,g+=0.7;b()},w=!0};
